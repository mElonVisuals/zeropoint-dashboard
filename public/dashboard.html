<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZeroPoint Dashboard - Advanced</title>
    <!-- Tailwind CSS CDN for utility classes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for modern typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <style>
        /* Base Styles: Setting up the primary font, background, and text color */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0A0A0A; /* Deepest dark background for contrast */
            color: #EAEAEA; /* Light text for readability */
            min-height: 100vh; /* Ensure body takes full viewport height */
            display: flex;
            flex-direction: column;
            overflow-x: hidden; /* Prevent horizontal scroll on small screens */
            position: relative; /* For z-index stacking context */
            z-index: 1; /* Ensure content is above background effects */
        }

        /* Animated Background Gradients: Creating subtle, moving light sources */
        .background-gradient-top {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60%;
            background: radial-gradient(circle at 15% 15%, rgba(95, 158, 160, 0.08) 0%, transparent 60%); /* Cadet Blue subtle glow */
            animation: moveGradientTop 30s infinite alternate ease-in-out; /* Slow, smooth animation */
            pointer-events: none; /* Allow clicks to pass through */
            z-index: -2; /* Behind the main content */
            filter: blur(120px); /* Heavy blur for ethereal effect */
        }
        .background-gradient-bottom {
            position: fixed;
            bottom: 0;
            right: 0;
            width: 100%;
            height: 60%;
            background: radial-gradient(circle at 85% 85%, rgba(70, 130, 180, 0.08) 0%, transparent 60%); /* Steel Blue subtle glow */
            animation: moveGradientBottom 30s infinite alternate-reverse ease-in-out; /* Reversed animation for variety */
            pointer-events: none;
            z-index: -2;
            filter: blur(120px);
        }

        /* Keyframe animations for background gradients */
        @keyframes moveGradientTop {
            0% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(10%, 10%) scale(1.1); }
            100% { transform: translate(0, 0) scale(1); }
        }
        @keyframes moveGradientBottom {
            0% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(-10%, -10%) scale(1.1); }
            100% { transform: translate(0, 0) scale(1); }
        }

        /* Subtle Noise Overlay: Adding a slight texture for depth */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* SVG data for a subtle noise pattern */
            background: url('data:image/svg+xml;base64,PHN2ZyB2aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z2kiPjxmaWx0ZXIgaWQ9ImYiPjxmZVR1cmJ1bGVuY2UgdHlwZT0ic3RhbmRhcmROb2lzZSIgYmFzZUZyZXF1ZW5jeT0iMC43NSIgbnVtT2N0YXZlcz0iMiIgc3RpdGNoVGlsZXM9InN0aXRjaEF2YWlsYWJsZSIvPjxmZUNvbG9yTWF0cml4IHR5cGU9InNhdHVyYXRlIiB2YWx1ZXM9IjAiLz48L2ZpbHRlcj48cmVjdCB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIGZpbGw9IiNGRkZGRkYiIGZpbHRlcj0idXJsKCNmKSIvPjwvc3ZnPg==');
            background-size: 100px; /* Size of the noise pattern */
            opacity: 0.01; /* Very subtle */
            z-index: -1; /* Between gradients and content */
            pointer-events: none;
        }

        /* Starfield Effect: Adding a dynamic background of twinkling stars */
        .starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -3; /* Furthest back */
            background: transparent;
            animation: twinkle 150s linear infinite; /* Very slow, long animation */
        }

        /* Pseudo-elements for star generation */
        .starfield::before, .starfield::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 1px;
            height: 1px;
            background: white;
            border-radius: 50%;
            /* Extensive box-shadow for numerous stars at varying positions */
            box-shadow:
                -200px 100px #fff, 150px 200px #fff, 300px 50px #fff, 400px 250px #fff, -100px 300px #fff,
                50px 400px #fff, 250px 150px #fff, 350px 350px #fff, -50px 50px #fff, 100px 280px #fff,
                -300px 180px #fff, 200px 450px #fff, 450px 100px #fff, -250px 220px #fff, 180px 380px #fff,
                -400px 20px #fff, 500px 120px #fff, -150px 480px #fff, 320px -50px #fff, 80px 520px #fff,
                -280px 350px #fff, 120px -80px #fff, 550px 280px #fff, -350px 100px #fff, 220px 420px #fff,
                -10px 10px #eee, 10px 20px #eee, 30px 5px #eee, 40px 25px #eee, -10px 30px #eee,
                5px 40px #eee, 25px 15px #eee, 35px 35px #eee, -5px 5px #eee, 10px 28px #eee,
                -30px 18px #eee, 20px 45px #eee, 45px 10px #eee, -25px 22px #eee, 18px 38px #eee,
                -80px 120px #ddd, 120px 80px #ddd, 280px 180px #ddd, 380px 20px #ddd, -150px 250px #ddd,
                70px 350px #ddd, 220px 100px #ddd, 320px 300px #ddd, -20px 200px #ddd, 150px 420px #ddd,
                -220px 50px #ddd, 100px 20px #ddd, 400px 300px #ddd, -80px 380px #ddd, 250px 70px #ddd,
                -600px 50px #ccc, 700px 300px #ccc, -400px 600px #ccc, 800px 100px #ccc, -200px 700px #ccc,
                100px 800px #ccc, 600px 400px #ccc, -500px 200px #ccc, 900px 500px #ccc, -300px 900px #ccc,
                -750px 250px #bbb, 850px 600px #bbb, -550px 800px #bbb, 950px 350px #bbb, -450px 1000px #bbb,
                250px 950px #bbb, 700px 750px #bbb, -650px 450px #bbb, 1000px 850px #bbb, -350px 1100px #bbb;
        }

        /* Keyframe animation for star twinkling/movement */
        @keyframes twinkle {
            0% { transform: translate(0, 0); opacity: 1; }
            25% { transform: translate(1%, -1%); opacity: 0.9; }
            50% { transform: translate(0, 0); opacity: 1; }
            75% { transform: translate(-1%, 1%); opacity: 0.9; }
            100% { transform: translate(0, 0); opacity: 1; }
        }

        /* Glassmorphism Effect for Containers and Cards */
        .glass-container {
            background-color: rgba(26, 26, 26, 0.6); /* Slightly transparent dark background */
            border: 1px solid rgba(58, 58, 58, 0.4); /* Transparent border */
            backdrop-filter: blur(10px); /* Glassmorphism blur effect */
            -webkit-backdrop-filter: blur(10px); /* Safari support for backdrop-filter */
            border-radius: 1rem; /* More rounded corners for modern feel */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4); /* Softer, deeper shadow for depth */
            transition: all 0.3s ease-in-out; /* Smooth transitions for hover effects */
        }
        .glass-container:hover {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6); /* Enhanced shadow on hover */
            border-color: rgba(95, 158, 160, 0.6); /* Accent border on hover */
        }

        /* Header Styling with Glassmorphism */
        header {
            background-color: rgba(26, 26, 26, 0.8); /* More opaque for header visibility */
            border-bottom: 1px solid rgba(58, 58, 58, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        /* Logout Button Styling */
        .btn-logout {
            background-color: #DC2626; /* Red-600 from Tailwind palette */
            transition: background-color 0.3s ease, transform 0.2s ease; /* Added transform for subtle hover */
            border-radius: 0.5rem;
            padding: 0.6rem 1.2rem;
            font-weight: 600;
        }
        .btn-logout:hover {
            background-color: #B91C1C; /* Darker red on hover */
            transform: translateY(-1px); /* Slight lift on hover */
        }

        /* Accent Colors (Cadet Blue and Steel Blue) */
        .accent-color {
            color: #5F9EA0; /* Cadet Blue */
        }
        .accent-bg {
            background-color: #5F9EA0; /* Cadet Blue */
        }
        .accent-border {
            border-color: #5F9EA0;
        }

        /* Card Styling for settings sections (inherits glass-container properties) */
        .card {
            background-color: rgba(10, 10, 10, 0.7); /* Slightly darker transparent for cards */
            border: 1px solid rgba(58, 58, 58, 0.3);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 0.75rem; /* More rounded */
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        }
        .card:hover {
            transform: translateY(-3px); /* Lift card on hover */
            box-shadow: 0 8px 20px rgba(0,0,0,0.3); /* Deeper shadow on hover */
            border-color: rgba(95, 158, 160, 0.5); /* Accent border on hover */
        }

        /* Input Fields Styling */
        .input-field {
            background-color: rgba(40, 40, 40, 0.7); /* Transparent dark for inputs */
            border: 1px solid rgba(85, 85, 85, 0.5);
            color: #EAEAEA;
            padding: 0.75rem;
            border-radius: 0.5rem;
            width: 100%;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .input-field:focus {
            outline: none;
            border-color: #5F9EA0;
            box-shadow: 0 0 0 3px rgba(95, 158, 160, 0.4); /* Wider, softer focus glow */
        }

        /* Guild Card in Sidebar Styling */
        .guild-card {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            background-color: rgba(40, 40, 40, 0.5); /* Transparent dark for guild cards */
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 0.6rem;
        }
        .guild-card:hover {
            transform: translateY(-2px);
            background-color: rgba(58, 58, 58, 0.6);
            border-color: rgba(95, 158, 160, 0.3);
        }
        .guild-card.selected {
            background-color: rgba(74, 74, 74, 0.7);
            border-color: #5F9EA0; /* Accent border for selected */
            box-shadow: 0 0 0 2px rgba(95, 158, 160, 0.5);
        }

        /* Save Button Styling */
        .save-button {
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        .save-button:hover {
            transform: translateY(-2px);
            opacity: 0.95;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        .save-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: translateY(0);
            box-shadow: none;
        }

        /* Status Message Styling (for success/error feedback) */
        .status-message {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .status-message.show {
            opacity: 1;
        }
        .status-success {
            color: #4CAF50; /* Green */
        }
        .status-error {
            color: #F44336; /* Red */
        }

        /* Custom Scrollbar Styling for a sleek look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1A1A1A;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #5F9EA0; /* Cadet Blue accent */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4682B4; /* Steel Blue on hover */
        }

        /* Embed Preview Specific Styles (for Discord-like embeds) */
        .embed-preview {
            border: 1px solid rgba(107, 114, 128, 0.5); /* Lighter, transparent border */
            border-left: 5px solid var(--embed-color, #4299e1); /* Dynamic left border color */
            padding: 1rem;
            border-radius: 0.5rem;
            background-color: rgba(44, 49, 58, 0.8); /* Transparent dark for embed preview */
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            max-width: 400px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .embed-title {
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.5rem;
        }
        .embed-description {
            color: #cbd5e0;
            margin-bottom: 0.5rem;
        }
        .embed-field-name {
            font-weight: 500;
            color: #fff;
        }
        .embed-field-value {
            color: #cbd5e0;
        }
        .embed-footer {
            font-size: 0.75rem;
            color: #a0aec0;
            margin-top: 0.5rem;
        }

        /* Modal Specific Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: rgba(26, 26, 26, 0.9);
            border: 1px solid rgba(58, 58, 58, 0.6);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
            width: 90%;
            max-width: 500px;
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .modal-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        .modal-button.confirm {
            background-color: #5F9EA0;
            color: white;
        }
        .modal-button.confirm:hover {
            background-color: #4682B4;
            transform: translateY(-1px);
        }
        .modal-button.cancel {
            background-color: #4A4A4A;
            color: #EAEAEA;
        }
        .modal-button.cancel:hover {
            background-color: #6A6A6A;
            transform: translateY(-1px);
        }

        /* Sidebar Navigation Items */
        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
            color: #B0B0B0; /* Lighter gray for inactive items */
        }
        .sidebar-item:hover {
            background-color: rgba(58, 58, 58, 0.5); /* Darker transparent on hover */
            color: #EAEAEA;
        }
        .sidebar-item.active {
            background-color: #5F9EA0; /* Accent background for active item */
            color: white;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(95, 158, 160, 0.3);
        }
        .sidebar-item.active .sidebar-icon {
            color: white; /* Ensure icon is white when active */
        }
        .sidebar-icon {
            margin-right: 0.75rem;
            font-size: 1.25rem;
            color: #B0B0B0; /* Default icon color */
        }

        /* Chart styling */
        .chart-container {
            position: relative;
            height: 300px; /* Fixed height for charts */
            width: 100%;
        }
    </style>
</head>
<body class="p-4">
    <!-- Background visual effects -->
    <div class="background-gradient-top"></div>
    <div class="background-gradient-bottom"></div>
    <div class="starfield"></div>

    <!-- Header Section -->
    <header class="w-full p-4 shadow-md flex flex-col sm:flex-row justify-between items-center z-10 rounded-lg mb-6">
        <div class="flex items-center mb-4 sm:mb-0">
            <img src="https://melonvisuals.me/test/zeropoint.png" alt="ZeroPoint Logo" class="w-12 h-12 rounded-full mr-3 border-2 border-indigo-400">
            <h1 class="text-3xl font-extrabold text-white tracking-wide">ZeroPoint Dashboard</h1>
        </div>
        <div class="flex items-center space-x-4">
            <span class="text-gray-300 text-lg">Logged in as <span id="username" class="font-semibold text-indigo-400">Loading...</span></span>
            <a href="/logout" class="px-6 py-3 text-base font-medium rounded-lg btn-logout shadow-md hover:shadow-lg">Logout</a>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col lg:flex-row p-6 gap-8 max-w-8xl mx-auto w-full relative z-10">
        <!-- Guild Selection Sidebar -->
        <aside class="w-full lg:w-1/4 p-6 rounded-xl shadow-xl glass-container h-full overflow-y-auto flex-shrink-0">
            <h2 class="text-2xl font-bold mb-6 text-white border-b border-gray-700 pb-3">Your Servers</h2>
            <p class="text-gray-400 text-sm mb-6">Select a server to configure ZeroPoint Bot settings.</p>
            
            <!-- Navigation for different setting categories -->
            <nav class="mb-6">
                <h3 class="text-lg font-semibold text-gray-300 mb-3">Settings Categories</h3>
                <ul>
                    <li><a href="#" id="nav-general" class="sidebar-item active"><i class="fas fa-cogs sidebar-icon"></i> General</a></li>
                    <li><a href="#" id="nav-welcome" class="sidebar-item"><i class="fas fa-hand-sparkles sidebar-icon"></i> Welcome & Farewell</a></li>
                    <li><a href="#" id="nav-logging" class="sidebar-item"><i class="fas fa-clipboard-list sidebar-icon"></i> Logging</a></li>
                    <li><a href="#" id="nav-ticket" class="sidebar-item"><i class="fas fa-headset sidebar-icon"></i> Ticket System</a></li>
                    <li><a href="#" id="nav-verification" class="sidebar-item"><i class="fas fa-user-check sidebar-icon"></i> Verification</a></li>
                    <li><a href="#" id="nav-custom-commands" class="sidebar-item"><i class="fas fa-terminal sidebar-icon"></i> Custom Commands</a></li>
                    <li><a href="#" id="nav-reaction-roles" class="sidebar-item"><i class="fas fa-hand-pointer sidebar-icon"></i> Reaction Roles</a></li>
                    <li><a href="#" id="nav-leveling" class="sidebar-item"><i class="fas fa-trophy sidebar-icon"></i> Leveling System</a></li>
                    <li><a href="#" id="nav-music" class="sidebar-item"><i class="fas fa-music sidebar-icon"></i> Music Bot</a></li>
                    <li><a href="#" id="nav-integrations" class="sidebar-item"><i class="fas fa-puzzle-piece sidebar-icon"></i> Integrations</a></li>
                    <li><a href="#" id="nav-analytics" class="sidebar-item"><i class="fas fa-chart-line sidebar-icon"></i> Server Analytics</a></li>
                    <li><a href="#" id="nav-audit-log" class="sidebar-item"><i class="fas fa-history sidebar-icon"></i> Audit Log</a></li>
                    <li><a href="#" id="nav-advanced" class="sidebar-item"><i class="fas fa-sliders-h sidebar-icon"></i> Advanced</a></li>
                    <li><a href="#" id="nav-announcement" class="sidebar-item"><i class="fas fa-bullhorn sidebar-icon"></i> Announcement Builder</a></li>
                </ul>
            </nav>

            <h3 id="guildsHeader" class="text-lg font-semibold text-gray-300 mb-3 mt-6 border-t border-gray-700 pt-3">Your Guilds (Bot Present):</h3>
            <ul id="guildList" class="space-y-3">
                <!-- Guilds will be dynamically populated here -->
                <li class="text-gray-400 p-3">Loading servers...</li>
            </ul>
        </aside>

        <!-- Main Settings Content Area -->
        <section class="flex-1 p-8 rounded-xl shadow-xl glass-container overflow-y-auto">
            <h2 class="text-3xl font-bold mb-8 text-white border-b border-gray-700 pb-4">Settings for <span id="selectedGuildName" class="accent-color">No Server Selected</span></h2>

            <!-- Message when no guild is selected -->
            <div id="noGuildSelected" class="text-center text-gray-400 mt-24">
                <p class="text-2xl font-semibold mb-4">üëã Welcome!</p>
                <p class="text-lg">Please select a server from the left sidebar to manage its settings.</p>
                <p class="text-sm mt-2">Only servers where the ZeroPoint Bot is present will be listed here.</p>
                <p class="text-sm mt-4">If you don't see your server, ensure the bot has been invited and has the necessary permissions.</p>
            </div>

            <!-- Settings Content (hidden by default) -->
            <div id="settingsContent" class="hidden">
                <div class="grid grid-cols-1 gap-8">
                    <!-- General Settings Card -->
                    <div id="general-settings" class="card settings-section">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-cogs mr-3 text-xl accent-color"></i> General Settings</h3>
                        <div class="mb-5">
                            <label for="botPrefix" class="block text-gray-400 text-sm font-bold mb-2">Bot Prefix</label>
                            <input type="text" id="botPrefix" class="input-field" placeholder="e.g., !">
                            <p class="text-xs text-gray-500 mt-1">The character your bot uses to listen for commands (e.g., `!help`).</p>
                        </div>
                        <div class="mb-5">
                            <label for="defaultRole" class="block text-gray-400 text-sm font-bold mb-2">Default New Member Role ID</label>
                            <input type="text" id="defaultRole" class="input-field" placeholder="e.g., 123456789012345678">
                            <p class="text-xs text-gray-500 mt-1">Role ID to automatically assign to new members. Leave empty for none.</p>
                        </div>
                        <button id="saveGeneralSettings" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg">Save General Settings</button>
                        <p id="generalStatus" class="status-message text-sm mt-3"></p>
                    </div>

                    <!-- Welcome & Farewell Message Settings Card -->
                    <div id="welcome-settings" class="card settings-section hidden">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-hand-sparkles mr-3 text-xl accent-color"></i> Welcome & Farewell Messages</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-medium text-white mb-3">Welcome Settings</h4>
                                <div class="mb-4">
                                    <label for="welcomeChannel" class="block text-gray-400 text-sm font-bold mb-2">Welcome Channel ID</label>
                                    <input type="text" id="welcomeChannel" class="input-field" placeholder="e.g., 123456789012345678">
                                    <p class="text-xs text-gray-500 mt-1">The channel where welcome messages will be sent.</p>
                                </div>
                                <div class="mb-4">
                                    <label for="welcomeMessage" class="block text-gray-400 text-sm font-bold mb-2">Welcome Message</label>
                                    <textarea id="welcomeMessage" class="input-field h-28 resize-y" placeholder="Welcome {user}!"></textarea>
                                    <p class="text-xs text-gray-500 mt-1">Use `{user}` to mention the new member, `{guild}` for server name.</p>
                                </div>
                                <div class="flex items-center mb-4">
                                    <input type="checkbox" id="welcomeDM" class="form-checkbox h-5 w-5 text-accent rounded mr-2">
                                    <label for="welcomeDM" class="text-gray-400 text-sm">Send Welcome DM?</label>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white mb-3">Farewell Settings</h4>
                                <div class="mb-4">
                                    <label for="farewellChannel" class="block text-gray-400 text-sm font-bold mb-2">Farewell Channel ID</label>
                                    <input type="text" id="farewellChannel" class="input-field" placeholder="e.g., 123456789012345678">
                                    <p class="text-xs text-gray-500 mt-1">The channel where farewell messages will be sent.</p>
                                </div>
                                <div class="mb-4">
                                    <label for="farewellMessage" class="block text-gray-400 text-sm font-bold mb-2">Farewell Message</label>
                                    <textarea id="farewellMessage" class="input-field h-28 resize-y" placeholder="{user} has left the server."></textarea>
                                    <p class="text-xs text-gray-500 mt-1">Use `{user}` to mention the leaving member.</p>
                                </div>
                            </div>
                        </div>
                        <button id="saveWelcomeSettings" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg mt-4">Save Welcome & Farewell Settings</button>
                        <p id="welcomeStatus" class="status-message text-sm mt-3"></p>
                    </div>

                    <!-- Logging Settings Card -->
                    <div id="logging-settings" class="card settings-section hidden">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-clipboard-list mr-3 text-xl accent-color"></i> Logging Settings</h3>
                        <div class="mb-5">
                            <label for="logChannel" class="block text-gray-400 text-sm font-bold mb-2">Log Channel ID</label>
                            <input type="text" id="logChannel" class="input-field" placeholder="e.g., 123456789012345678">
                            <p class="text-xs text-gray-500 mt-1">All bot-related logs will be sent to this channel.</p>
                        </div>
                        <div class="flex items-center mb-3">
                            <input type="checkbox" id="logMessages" class="form-checkbox h-5 w-5 text-accent rounded mr-2">
                            <label for="logMessages" class="text-gray-400 text-sm">Log Message Edits/Deletes?</label>
                        </div>
                        <div class="flex items-center mb-3">
                            <input type="checkbox" id="logChannels" class="form-checkbox h-5 w-5 text-accent rounded mr-2">
                            <label for="logChannels" class="text-gray-400 text-sm">Log Channel Changes?</label>
                        </div>
                        <div class="flex items-center mb-5">
                            <input type="checkbox" id="logMembers" class="form-checkbox h-5 w-5 text-accent rounded mr-2">
                            <label for="logMembers" class="text-gray-400 text-sm">Log Member Joins/Leaves?</label>
                        </div>
                        <button id="saveLoggingSettings" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg">Save Logging Settings</button>
                        <p id="loggingStatus" class="status-message text-sm mt-3"></p>
                    </div>

                    <!-- Ticket System Settings Card -->
                    <div id="ticket-settings" class="card settings-section hidden">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-headset mr-3 text-xl accent-color"></i> Ticket System</h3>
                        <div class="mb-5">
                            <label for="ticketCategory" class="block text-gray-400 text-sm font-bold mb-2">Ticket Category ID</label>
                            <input type="text" id="ticketCategory" class="input-field" placeholder="e.g., 123456789012345678">
                            <p class="text-xs text-gray-500 mt-1">New tickets will be created under this category.</p>
                        </div>
                        <div class="mb-5">
                            <label for="ticketRole" class="block text-gray-400 text-sm font-bold mb-2">Support Role ID</label>
                            <input type="text" id="ticketRole" class="input-field" placeholder="e.g., 123456789012345678">
                            <p class="text-xs text-gray-500 mt-1">Members with this role can manage tickets.</p>
                        </div>
                        <div class="mb-5">
                            <label for="ticketMessage" class="block text-gray-400 text-sm font-bold mb-2">Ticket Welcome Message</label>
                            <textarea id="ticketMessage" class="input-field h-24 resize-y" placeholder="Hello {user}! How can we help you today?"></textarea>
                            <p class="text-xs text-gray-500 mt-1">Message sent when a new ticket is opened.</p>
                        </div>
                        <button id="saveTicketSettings" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg">Save Ticket Settings</button>
                        <p id="ticketStatus" class="status-message text-sm mt-3"></p>
                    </div>

                    <!-- Verification Settings Section -->
                    <div id="verification-settings" class="card settings-section hidden">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-user-check mr-3 text-xl accent-color"></i> Verification System Settings</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-medium text-white mb-3">Core Settings</h4>
                                <div class="mb-4">
                                    <label for="verificationChannelId" class="block text-gray-400 text-sm font-bold mb-2">Verification Channel ID:</label>
                                    <input type="text" id="verificationChannelId" class="input-field" placeholder="Enter verification channel ID">
                                    <p class="text-xs text-gray-500 mt-1">The channel where the verification message will be posted.</p>
                                </div>
                                <div class="mb-4">
                                    <label for="unverifiedRoleId" class="block text-gray-400 text-sm font-bold mb-2">Unverified Role ID:</label>
                                    <input type="text" id="unverifiedRoleId" class="input-field" placeholder="Enter unverified role ID">
                                    <p class="text-xs text-gray-500 mt-1">Role assigned to new members before verification.</p>
                                </div>
                                <div class="mb-4">
                                    <label for="verifiedRoleId" class="block text-gray-400 text-sm font-bold mb-2">Verified Role ID:</label>
                                    <input type="text" id="verifiedRoleId" class="input-field" placeholder="Enter verified role ID">
                                    <p class="text-xs text-gray-500 mt-1">Role assigned after successful verification.</p>
                                </div>
                                <div class="mb-4">
                                    <label for="verificationMessageContent" class="block text-gray-400 text-sm font-bold mb-2">Message Content (above embed):</label>
                                    <textarea id="verificationMessageContent" class="input-field h-24 resize-y" placeholder="Welcome {user}! Click the button below to verify."></textarea>
                                    <p class="text-xs text-gray-500 mt-1">Optional text to appear above the verification embed.</p>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white mb-3">Embed Builder</h4>
                                <div class="mb-3">
                                    <label for="verificationEmbedTitle" class="block text-gray-400 text-sm font-bold mb-1">Title:</label>
                                    <input type="text" id="verificationEmbedTitle" class="input-field" placeholder="Verification Embed Title">
                                </div>
                                <div class="mb-3">
                                    <label for="verificationEmbedDescription" class="block text-gray-400 text-sm font-bold mb-1">Description:</label>
                                    <textarea id="verificationEmbedDescription" class="input-field h-24 resize-y" placeholder="Click the button to gain full access."></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="verificationEmbedColor" class="block text-gray-400 text-sm font-bold mb-1">Color (Hex):</label>
                                    <input type="text" id="verificationEmbedColor" class="input-field" placeholder="#2cb4e9">
                                </div>
                                <div class="mb-3">
                                    <label for="verificationEmbedFooter" class="block text-gray-400 text-sm font-bold mb-1">Footer Text:</label>
                                    <input type="text" id="verificationEmbedFooter" class="input-field" placeholder="ZeroPoint | Verification">
                                </div>
                                <div class="mb-3">
                                    <label for="verificationEmbedThumbnail" class="block text-gray-400 text-sm font-bold mb-1">Thumbnail URL:</label>
                                    <input type="text" id="verificationEmbedThumbnail" class="input-field" placeholder="https://example.com/logo.png">
                                </div>
                                <h5 class="text-md font-medium text-white mb-2 mt-4">Embed Preview</h5>
                                <div id="verification-embed-preview" class="embed-preview" style="--embed-color: #4299e1;">
                                    <div class="embed-title" id="preview-verification-embed-title">Verification Embed Title</div>
                                    <div class="embed-description" id="preview-verification-embed-description">Click the button to gain full access.</div>
                                    <div class="embed-footer" id="preview-verification-embed-footer">ZeroPoint | Verification</div>
                                    <img id="preview-verification-embed-thumbnail" src="" alt="Thumbnail Preview" class="mt-2 hidden w-16 h-16 object-cover rounded-md">
                                </div>
                            </div>
                        </div>
                        <button id="saveVerificationSettings" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg mt-6">Save Verification Settings</button>
                        <p id="verificationStatus" class="status-message text-sm mt-3"></p>
                    </div>

                    <!-- Custom Commands Section -->
                    <div id="custom-commands-settings" class="card settings-section hidden">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-terminal mr-3 text-xl accent-color"></i> Custom Commands</h3>
                        <div class="mb-4">
                            <label for="newCommandName" class="block text-gray-400 text-sm font-bold mb-2">Command Name (e.g., `!hello`)</label>
                            <input type="text" id="newCommandName" class="input-field" placeholder="e.g., hello">
                        </div>
                        <div class="mb-4">
                            <label for="newCommandResponse" class="block text-gray-400 text-sm font-bold mb-2">Command Response</label>
                            <textarea id="newCommandResponse" class="input-field h-24 resize-y" placeholder="Hello {user}!"></textarea>
                            <p class="text-xs text-gray-500 mt-1">Use `{user}` to mention the user, `{channel}` for current channel.</p>
                        </div>
                        <div class="mb-4">
                            <label for="newCommandType" class="block text-gray-400 text-sm font-bold mb-2">Response Type</label>
                            <select id="newCommandType" class="input-field">
                                <option value="text">Text</option>
                                <option value="embed">Embed</option>
                            </select>
                        </div>
                        <div id="newCommandEmbedFields" class="hidden border border-gray-700 p-4 rounded-md mb-4">
                            <h4 class="text-lg font-medium text-white mb-3">Embed Details</h4>
                            <div class="mb-3">
                                <label for="newCommandEmbedTitle" class="block text-gray-400 text-sm font-bold mb-1">Embed Title:</label>
                                <input type="text" id="newCommandEmbedTitle" class="input-field" placeholder="Embed Title">
                            </div>
                            <div class="mb-3">
                                <label for="newCommandEmbedDescription" class="block text-gray-400 text-sm font-bold mb-1">Embed Description:</label>
                                <textarea id="newCommandEmbedDescription" class="input-field h-20 resize-y" placeholder="Embed Description"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="newCommandEmbedColor" class="block text-gray-400 text-sm font-bold mb-1">Embed Color (Hex):</label>
                                <input type="text" id="newCommandEmbedColor" class="input-field" placeholder="#5F9EA0">
                            </div>
                        </div>
                        <button id="addCustomCommand" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg mb-6">Add Custom Command</button>
                        <p id="customCommandStatus" class="status-message text-sm mt-3"></p>

                        <h4 class="text-lg font-semibold text-white mb-4 border-t border-gray-700 pt-4">Existing Commands</h4>
                        <ul id="customCommandsList" class="space-y-3">
                            <li class="text-gray-400">No custom commands added yet.</li>
                        </ul>
                    </div>

                    <!-- Reaction Roles Section -->
                    <div id="reaction-roles-settings" class="card settings-section hidden">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-hand-pointer mr-3 text-xl accent-color"></i> Reaction Roles</h3>
                        <div class="mb-4">
                            <label for="reactionRoleChannelId" class="block text-gray-400 text-sm font-bold mb-2">Channel ID for Reaction Role Message</label>
                            <input type="text" id="reactionRoleChannelId" class="input-field" placeholder="e.g., 123456789012345678">
                        </div>
                        <div class="mb-4">
                            <label for="reactionRoleMessageContent" class="block text-gray-400 text-sm font-bold mb-2">Message Content</label>
                            <textarea id="reactionRoleMessageContent" class="input-field h-24 resize-y" placeholder="React to get roles!"></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="reactionRoleEmoji" class="block text-gray-400 text-sm font-bold mb-2">Emoji (e.g., üëç)</label>
                            <input type="text" id="reactionRoleEmoji" class="input-field" placeholder="e.g., üëç">
                        </div>
                        <div class="mb-4">
                            <label for="reactionRoleRoleId" class="block text-gray-400 text-sm font-bold mb-2">Role ID to Assign</label>
                            <input type="text" id="reactionRoleRoleId" class="input-field" placeholder="e.g., 123456789012345678">
                        </div>
                        <button id="addReactionRole" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg mb-6">Add Reaction Role</button>
                        <p id="reactionRoleStatus" class="status-message text-sm mt-3"></p>

                        <h4 class="text-lg font-semibold text-white mb-4 border-t border-gray-700 pt-4">Configured Reaction Roles</h4>
                        <ul id="reactionRolesList" class="space-y-3">
                            <li class="text-gray-400">No reaction roles configured yet.</li>
                        </ul>
                    </div>

                    <!-- Leveling System Settings -->
                    <div id="leveling-settings" class="card settings-section hidden">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-trophy mr-3 text-xl accent-color"></i> Leveling System</h3>
                        <div class="mb-5">
                            <label for="xpPerMessage" class="block text-gray-400 text-sm font-bold mb-2">XP per Message</label>
                            <input type="number" id="xpPerMessage" class="input-field" min="1" value="15">
                        </div>
                        <div class="mb-5">
                            <label for="xpCooldown" class="block text-gray-400 text-sm font-bold mb-2">XP Cooldown (seconds)</label>
                            <input type="number" id="xpCooldown" class="input-field" min="5" value="60">
                        </div>
                        <div class="mb-5">
                            <label for="levelUpMessage" class="block text-gray-400 text-sm font-bold mb-2">Level Up Message</label>
                            <textarea id="levelUpMessage" class="input-field h-24 resize-y" placeholder="Congratulations {user}, you reached level {level}!"></textarea>
                            <p class="text-xs text-gray-500 mt-1">Use `{user}` for member, `{level}` for new level.</p>
                        </div>
                        <div class="mb-5">
                            <label for="levelUpChannel" class="block text-gray-400 text-sm font-bold mb-2">Level Up Announcement Channel ID</label>
                            <input type="text" id="levelUpChannel" class="input-field" placeholder="e.g., 123456789012345678">
                            <p class="text-xs text-gray-500 mt-1">Leave empty to send in current channel.</p>
                        </div>
                        <h4 class="text-lg font-semibold text-white mb-4 border-t border-gray-700 pt-4">Level Rewards</h4>
                        <div class="mb-4">
                            <label for="rewardLevel" class="block text-gray-400 text-sm font-bold mb-2">Level</label>
                            <input type="number" id="rewardLevel" class="input-field" min="1">
                        </div>
                        <div class="mb-4">
                            <label for="rewardRoleId" class="block text-gray-400 text-sm font-bold mb-2">Role ID to Grant</label>
                            <input type="text" id="rewardRoleId" class="input-field" placeholder="e.g., 123456789012345678">
                        </div>
                        <button id="addLevelReward" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg mb-6">Add Level Reward</button>
                        <p id="levelingStatus" class="status-message text-sm mt-3"></p>
                        <h4 class="text-lg font-semibold text-white mb-4 border-t border-gray-700 pt-4">Configured Level Rewards</h4>
                        <ul id="levelRewardsList" class="space-y-3">
                            <li class="text-gray-400">No level rewards configured yet.</li>
                        </ul>
                        <button id="saveLevelingSettings" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg mt-6">Save Leveling Settings</button>
                    </div>

                    <!-- Music Bot Settings -->
                    <div id="music-settings" class="card settings-section hidden">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-music mr-3 text-xl accent-color"></i> Music Bot Settings</h3>
                        <div class="mb-5">
                            <label for="musicChannel" class="block text-gray-400 text-sm font-bold mb-2">Default Music Channel ID</label>
                            <input type="text" id="musicChannel" class="input-field" placeholder="e.g., 123456789012345678">
                            <p class="text-xs text-gray-500 mt-1">Bot will prioritize joining this voice channel.</p>
                        </div>
                        <div class="mb-5">
                            <label for="djRoleId" class="block text-gray-400 text-sm font-bold mb-2">DJ Role ID</label>
                            <input type="text" id="djRoleId" class="input-field" placeholder="e.g., 123456789012345678">
                            <p class="text-xs text-gray-500 mt-1">Only members with this role can use music commands (optional).</p>
                        </div>
                        <div class="flex items-center mb-5">
                            <input type="checkbox" id="allowAnyoneQueue" class="form-checkbox h-5 w-5 text-accent rounded mr-2">
                            <label for="allowAnyoneQueue" class="text-gray-400 text-sm">Allow Anyone to Queue Songs?</label>
                        </div>
                        <button id="saveMusicSettings" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg">Save Music Settings</button>
                        <p id="musicStatus" class="status-message text-sm mt-3"></p>
                    </div>

                    <!-- Integrations Settings -->
                    <div id="integrations-settings" class="card settings-section hidden">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-puzzle-piece mr-3 text-xl accent-color"></i> Integrations</h3>
                        <p class="text-gray-400 mb-6">Configure connections to external services.</p>

                        <h4 class="text-lg font-medium text-white mb-3">Webhook Integration</h4>
                        <div class="mb-4">
                            <label for="webhookUrl" class="block text-gray-400 text-sm font-bold mb-2">Webhook URL</label>
                            <input type="url" id="webhookUrl" class="input-field" placeholder="https://discord.com/api/webhooks/...">
                            <p class="text-xs text-gray-500 mt-1">For sending custom messages via webhooks.</p>
                        </div>
                        <div class="mb-5">
                            <label for="webhookChannelId" class="block text-gray-400 text-sm font-bold mb-2">Webhook Target Channel ID</label>
                            <input type="text" id="webhookChannelId" class="input-field" placeholder="e.g., 123456789012345678">
                            <p class="text-xs text-gray-500 mt-1">The channel where webhook messages will be sent.</p>
                        </div>
                        <button id="saveIntegrationsSettings" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg">Save Integrations</button>
                        <p id="integrationsStatus" class="status-message text-sm mt-3"></p>
                    </div>

                    <!-- Server Analytics Section -->
                    <div id="analytics-settings" class="card settings-section hidden">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-chart-line mr-3 text-xl accent-color"></i> Server Analytics</h3>
                        <p class="text-gray-400 mb-6">View key statistics for your server.</p>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                            <div class="p-4 bg-gray-800 rounded-lg shadow-inner text-center">
                                <p class="text-sm text-gray-400">Total Members</p>
                                <p id="totalMembers" class="text-3xl font-bold text-white mt-2">--</p>
                            </div>
                            <div class="p-4 bg-gray-800 rounded-lg shadow-inner text-center">
                                <p class="text-sm text-gray-400">Messages Sent (24h)</p>
                                <p id="messages24h" class="text-3xl font-bold text-white mt-2">--</p>
                            </div>
                            <div class="p-4 bg-gray-800 rounded-lg shadow-inner text-center">
                                <p class="text-sm text-gray-400">New Members (7d)</p>
                                <p id="newMembers7d" class="text-3xl font-bold text-white mt-2">--</p>
                            </div>
                        </div>

                        <h4 class="text-lg font-semibold text-white mb-4">Member Growth Over Time</h4>
                        <div class="chart-container glass-container p-4">
                            <canvas id="memberGrowthChart"></canvas>
                        </div>

                        <h4 class="text-lg font-semibold text-white mb-4 mt-8">Message Activity (Last 7 Days)</h4>
                        <div class="chart-container glass-container p-4">
                            <canvas id="messageActivityChart"></canvas>
                        </div>
                    </div>

                    <!-- Audit Log Viewer Section -->
                    <div id="audit-log-settings" class="card settings-section hidden">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-history mr-3 text-xl accent-color"></i> Audit Log Viewer</h3>
                        <p class="text-gray-400 mb-6">Review recent actions taken on your server by users and bots.</p>

                        <div class="mb-6 flex flex-col sm:flex-row gap-4">
                            <input type="text" id="auditLogSearch" class="input-field flex-1" placeholder="Search by user, action, or keyword...">
                            <select id="auditLogFilterType" class="input-field w-full sm:w-auto">
                                <option value="">All Types</option>
                                <option value="MEMBER_KICK">Member Kick</option>
                                <option value="MEMBER_BAN_ADD">Member Ban</option>
                                <option value="CHANNEL_CREATE">Channel Create</option>
                                <option value="ROLE_UPDATE">Role Update</option>
                                <option value="MESSAGE_DELETE">Message Delete</option>
                                <!-- Add more types as needed -->
                            </select>
                            <button id="refreshAuditLog" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg">Refresh</button>
                        </div>

                        <div id="auditLogList" class="space-y-3 max-h-96 overflow-y-auto custom-scrollbar">
                            <!-- Audit log entries will be populated here -->
                            <p class="text-gray-400 text-center py-4">Loading audit log entries...</p>
                        </div>
                        <p id="auditLogStatus" class="status-message text-sm mt-3"></p>
                    </div>

                    <!-- Advanced Settings Card -->
                    <div id="advanced-settings" class="card settings-section hidden">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-sliders-h mr-3 text-xl accent-color"></i> Advanced Settings</h3>
                        <div class="mb-5">
                            <label for="commandCooldown" class="block text-gray-400 text-sm font-bold mb-2">Global Command Cooldown (seconds)</label>
                            <input type="number" id="commandCooldown" class="input-field" min="0" value="3" placeholder="e.g., 3">
                            <p class="text-xs text-gray-500 mt-1">Minimum time between bot command uses by the same user.</p>
                        </div>
                        <div class="flex items-center mb-5">
                            <input type="checkbox" id="enableAI" class="form-checkbox h-5 w-5 text-accent rounded mr-2">
                            <label for="enableAI" class="text-gray-400 text-sm">Enable AI Responses (Experimental)?</label>
                        </div>
                        <div class="mb-5">
                            <label for="adminRoleId" class="block text-gray-400 text-sm font-bold mb-2">Bot Admin Role ID</label>
                            <input type="text" id="adminRoleId" class="input-field" placeholder="e.g., 123456789012345678">
                            <p class="text-xs text-gray-500 mt-1">Users with this role can bypass certain bot permissions.</p>
                        </div>
                        <button id="saveAdvancedSettings" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg">Save Advanced Settings</button>
                        <p id="advancedStatus" class="status-message text-sm mt-3"></p>
                    </div>

                    <!-- Announcement Builder Card -->
                    <div id="announcement-settings" class="card settings-section hidden">
                        <h3 class="text-xl font-semibold mb-5 text-white flex items-center"><i class="fas fa-bullhorn mr-3 text-xl accent-color"></i> Announcement Builder (Embed)</h3>
                        <p class="text-gray-400 mb-6">Create and send rich embed announcements to any channel.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <div class="mb-4">
                                    <label for="announcementChannelId" class="block text-gray-400 text-sm font-bold mb-2">Target Channel ID</label>
                                    <input type="text" id="announcementChannelId" class="input-field" placeholder="e.g., 123456789012345678">
                                    <p class="text-xs text-gray-500 mt-1">The channel where this announcement will be sent.</p>
                                </div>
                                <div class="mb-4">
                                    <label for="announcementEmbedTitle" class="block text-gray-400 text-sm font-bold mb-2">Embed Title</label>
                                    <input type="text" id="announcementEmbedTitle" class="input-field" placeholder="e.g., Important Update!">
                                </div>
                                <div class="mb-4">
                                    <label for="announcementEmbedDescription" class="block text-gray-400 text-sm font-bold mb-2">Embed Description</label>
                                    <textarea id="announcementEmbedDescription" class="input-field h-28 resize-y" placeholder="Details about the announcement..."></textarea>
                                </div>
                                <div class="mb-4">
                                    <label for="announcementEmbedColor" class="block text-gray-400 text-sm font-bold mb-2">Embed Color (Hex Code)</label>
                                    <input type="text" id="announcementEmbedColor" class="input-field" value="#5F9EA0" placeholder="e.g., #5F9EA0">
                                </div>
                                <div class="mb-4">
                                    <label for="announcementEmbedFooter" class="block text-gray-400 text-sm font-bold mb-2">Embed Footer Text:</label>
                                    <input type="text" id="announcementEmbedFooter" class="input-field" placeholder="ZeroPoint Bot Announcement">
                                </div>
                                <div class="mb-4">
                                    <label for="announcementEmbedThumbnail" class="block text-gray-400 text-sm font-bold mb-2">Embed Thumbnail URL:</label>
                                    <input type="text" id="announcementEmbedThumbnail" class="input-field" placeholder="https://example.com/logo.png">
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white mb-3">Embed Preview</h4>
                                <div id="announcement-embed-preview" class="embed-preview" style="--embed-color: #5F9EA0;">
                                    <div class="embed-title" id="preview-announcement-embed-title">Important Update!</div>
                                    <div class="embed-description" id="preview-announcement-embed-description">Details about the announcement...</div>
                                    <div class="embed-footer" id="preview-announcement-embed-footer">ZeroPoint Bot Announcement</div>
                                    <img id="preview-announcement-embed-thumbnail" src="" alt="Thumbnail Preview" class="mt-2 hidden w-16 h-16 object-cover rounded-md">
                                </div>
                            </div>
                        </div>
                        <button id="sendAnnouncementBtn" class="save-button accent-bg text-white px-5 py-2.5 rounded-lg hover:opacity-90 transition-all shadow-lg mt-6">Send Announcement</button>
                        <p id="announcementStatus" class="status-message text-sm mt-3"></p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer Section -->
    <footer class="w-full bg-[#1A1A1A] p-4 text-center text-gray-500 text-sm mt-auto z-10 rounded-t-lg">
        &copy; <span id="current-year"></span> ZeroPoint. All rights reserved.
    </footer>

    <!-- Custom Modal for Alerts/Confirmations (replaces alert() and confirm()) -->
    <div id="customModalOverlay" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modalTitle" class="text-xl font-bold text-white mb-4"></h3>
            <p id="modalMessage" class="text-gray-300 mb-6"></p>
            <div class="modal-buttons">
                <button id="modalCancelBtn" class="modal-button cancel">Cancel</button>
                <button id="modalConfirmBtn" class="modal-button confirm">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // Define base URL for API calls (assumed to be your Node.js/Express backend)
        const BASE_URL = window.location.origin;

        // Global variables for dashboard state
        let userGuilds = []; // Stores guilds the user is a member of
        let botGuilds = [];  // Stores guilds the bot is present in
        let selectedGuildId = null; // Currently selected guild ID
        let selectedGuildName = ''; // Currently selected guild name
        let currentUserId = null; // Stores the authenticated user's ID

        // Chart instances
        let memberGrowthChartInstance = null;
        let messageActivityChartInstance = null;

        // --- DOM Element References (assigned on DOMContentLoaded) ---
        let usernameSpan, guildListElement, guildsHeader, selectedGuildNameSpanElement, settingsContentDiv, noGuildSelectedDiv;

        // Navigation elements
        let navGeneral, navWelcome, navLogging, navTicket, navVerification, navCustomCommands, navReactionRoles, navLeveling, navMusic, navIntegrations, navAnalytics, navAuditLog, navAdvanced, navAnnouncement;

        // Section containers
        let generalSettingsSection, welcomeSettingsSection, loggingSettingsSection, ticketSettingsSection, verificationSettingsSection, customCommandsSettingsSection, reactionRolesSettingsSection, levelingSettingsSection, musicSettingsSection, integrationsSettingsSection, analyticsSettingsSection, auditLogSettingsSection, advancedSettingsSection, announcementSettingsSection;

        // Input fields for various settings
        let botPrefixInput, defaultRoleInput; // General
        let welcomeChannelInput, welcomeMessageInput, welcomeDMCheckbox, farewellChannelInput, farewellMessageInput; // Welcome & Farewell
        let logChannelInput, logMessagesCheckbox, logChannelsCheckbox, logMembersCheckbox; // Logging
        let ticketCategoryInput, ticketRoleInput, ticketMessageInput; // Ticket
        let verificationChannelIdInput, unverifiedRoleIdInput, verifiedRoleIdInput, verificationMessageContentInput; // Verification
        let verificationEmbedTitleInput, verificationEmbedDescriptionInput, verificationEmbedColorInput, verificationEmbedFooterInput, verificationEmbedThumbnailInput; // Verification Embed
        let newCommandNameInput, newCommandResponseInput, newCommandTypeInput, newCommandEmbedFieldsDiv, newCommandEmbedTitleInput, newCommandEmbedDescriptionInput, newCommandEmbedColorInput; // Custom Commands
        let reactionRoleChannelIdInput, reactionRoleMessageContentInput, reactionRoleEmojiInput, reactionRoleRoleIdInput; // Reaction Roles
        let xpPerMessageInput, xpCooldownInput, levelUpMessageInput, levelUpChannelInput, rewardLevelInput, rewardRoleIdInput; // Leveling
        let musicChannelInput, djRoleIdInput, allowAnyoneQueueCheckbox; // Music
        let webhookUrlInput, webhookChannelIdInput; // Integrations
        let commandCooldownInput, enableAICheckbox, adminRoleIdInput; // Advanced
        let announcementChannelIdInput, announcementEmbedTitleInput, announcementEmbedDescriptionInput, announcementEmbedColorInput, announcementEmbedFooterInput, announcementEmbedThumbnailInput; // Announcement

        // Embed preview elements
        let verificationEmbedPreview, previewVerificationEmbedTitle, previewVerificationEmbedDescription, previewVerificationEmbedFooter, previewVerificationEmbedThumbnail;
        let announcementEmbedPreview, previewAnnouncementEmbedTitle, previewAnnouncementEmbedDescription, previewAnnouncementEmbedFooter, previewAnnouncementEmbedThumbnail;

        // Save/Action buttons
        let saveGeneralSettingsBtn, saveWelcomeSettingsBtn, saveLoggingSettingsBtn, saveTicketSettingsBtn, saveVerificationSettingsBtn, addCustomCommandBtn, addReactionRoleBtn, addLevelRewardBtn, saveMusicSettingsBtn, saveIntegrationsSettingsBtn, saveLevelingSettingsBtn, saveAdvancedSettingsBtn, sendAnnouncementBtn;

        // Status message elements
        let generalStatusMsg, welcomeStatusMsg, loggingStatusMsg, ticketStatusMsg, verificationStatusMsg, customCommandStatusMsg, reactionRoleStatusMsg, levelingStatusMsg, musicStatusMsg, integrationsStatusMsg, advancedStatusMsg, announcementStatusMsg, auditLogStatusMsg;

        // Analytics elements
        let totalMembersSpan, messages24hSpan, newMembers7dSpan;
        let memberGrowthChartCanvas, messageActivityChartCanvas;

        // Audit Log elements
        let auditLogSearchInput, auditLogFilterTypeSelect, refreshAuditLogBtn, auditLogListDiv;

        // Modal elements
        let customModalOverlay, modalTitle, modalMessage, modalCancelBtn, modalConfirmBtn;

        /**
         * Initializes the dashboard when the DOM is fully loaded.
         * Assigns DOM elements, fetches initial data, renders guild list, and sets up event listeners.
         */
        document.addEventListener('DOMContentLoaded', async () => {
            // --- Assign DOM Elements ---
            usernameSpan = document.getElementById('username');
            guildListElement = document.getElementById('guildList');
            guildsHeader = document.getElementById('guildsHeader');
            selectedGuildNameSpanElement = document.getElementById('selectedGuildName');
            settingsContentDiv = document.getElementById('settingsContent');
            noGuildSelectedDiv = document.getElementById('noGuildSelected');

            // Navigation elements
            navGeneral = document.getElementById('nav-general');
            navWelcome = document.getElementById('nav-welcome');
            navLogging = document.getElementById('nav-logging');
            navTicket = document.getElementById('nav-ticket');
            navVerification = document.getElementById('nav-verification');
            navCustomCommands = document.getElementById('nav-custom-commands');
            navReactionRoles = document.getElementById('nav-reaction-roles');
            navLeveling = document.getElementById('nav-leveling');
            navMusic = document.getElementById('nav-music');
            navIntegrations = document.getElementById('nav-integrations');
            navAnalytics = document.getElementById('nav-analytics');
            navAuditLog = document.getElementById('nav-audit-log');
            navAdvanced = document.getElementById('nav-advanced');
            navAnnouncement = document.getElementById('nav-announcement');

            // Section containers
            generalSettingsSection = document.getElementById('general-settings');
            welcomeSettingsSection = document.getElementById('welcome-settings');
            loggingSettingsSection = document.getElementById('logging-settings');
            ticketSettingsSection = document.getElementById('ticket-settings');
            verificationSettingsSection = document.getElementById('verification-settings');
            customCommandsSettingsSection = document.getElementById('custom-commands-settings');
            reactionRolesSettingsSection = document.getElementById('reaction-roles-settings');
            levelingSettingsSection = document.getElementById('leveling-settings');
            musicSettingsSection = document.getElementById('music-settings');
            integrationsSettingsSection = document.getElementById('integrations-settings');
            analyticsSettingsSection = document.getElementById('analytics-settings');
            auditLogSettingsSection = document.getElementById('audit-log-settings');
            advancedSettingsSection = document.getElementById('advanced-settings');
            announcementSettingsSection = document.getElementById('announcement-settings');

            // Input fields
            botPrefixInput = document.getElementById('botPrefix');
            defaultRoleInput = document.getElementById('defaultRole');
            welcomeChannelInput = document.getElementById('welcomeChannel');
            welcomeMessageInput = document.getElementById('welcomeMessage');
            welcomeDMCheckbox = document.getElementById('welcomeDM');
            farewellChannelInput = document.getElementById('farewellChannel');
            farewellMessageInput = document.getElementById('farewellMessage');
            logChannelInput = document.getElementById('logChannel');
            logMessagesCheckbox = document.getElementById('logMessages');
            logChannelsCheckbox = document.getElementById('logChannels');
            logMembersCheckbox = document.getElementById('logMembers');
            ticketCategoryInput = document.getElementById('ticketCategory');
            ticketRoleInput = document.getElementById('ticketRole');
            ticketMessageInput = document.getElementById('ticketMessage');
            verificationChannelIdInput = document.getElementById('verificationChannelId');
            unverifiedRoleIdInput = document.getElementById('unverifiedRoleId');
            verifiedRoleIdInput = document.getElementById('verifiedRoleId');
            verificationMessageContentInput = document.getElementById('verificationMessageContent');
            verificationEmbedTitleInput = document.getElementById('verificationEmbedTitle');
            verificationEmbedDescriptionInput = document.getElementById('verificationEmbedDescription');
            verificationEmbedColorInput = document.getElementById('verificationEmbedColor');
            verificationEmbedFooterInput = document.getElementById('verificationEmbedFooter');
            verificationEmbedThumbnailInput = document.getElementById('verificationEmbedThumbnail');
            newCommandNameInput = document.getElementById('newCommandName');
            newCommandResponseInput = document.getElementById('newCommandResponse');
            newCommandTypeInput = document.getElementById('newCommandType');
            newCommandEmbedFieldsDiv = document.getElementById('newCommandEmbedFields');
            newCommandEmbedTitleInput = document.getElementById('newCommandEmbedTitle');
            newCommandEmbedDescriptionInput = document.getElementById('newCommandEmbedDescription');
            newCommandEmbedColorInput = document.getElementById('newCommandEmbedColor');
            reactionRoleChannelIdInput = document.getElementById('reactionRoleChannelId');
            reactionRoleMessageContentInput = document.getElementById('reactionRoleMessageContent');
            reactionRoleEmojiInput = document.getElementById('reactionRoleEmoji');
            reactionRoleRoleIdInput = document.getElementById('reactionRoleRoleId');
            xpPerMessageInput = document.getElementById('xpPerMessage');
            xpCooldownInput = document.getElementById('xpCooldown');
            levelUpMessageInput = document.getElementById('levelUpMessage');
            levelUpChannelInput = document.getElementById('levelUpChannel');
            rewardLevelInput = document.getElementById('rewardLevel');
            rewardRoleIdInput = document.getElementById('rewardRoleId');
            musicChannelInput = document.getElementById('musicChannel');
            djRoleIdInput = document.getElementById('djRoleId');
            allowAnyoneQueueCheckbox = document.getElementById('allowAnyoneQueue');
            webhookUrlInput = document.getElementById('webhookUrl');
            webhookChannelIdInput = document.getElementById('webhookChannelId');
            commandCooldownInput = document.getElementById('commandCooldown');
            enableAICheckbox = document.getElementById('enableAI');
            adminRoleIdInput = document.getElementById('adminRoleId');
            announcementChannelIdInput = document.getElementById('announcementChannelId');
            announcementEmbedTitleInput = document.getElementById('announcementEmbedTitle');
            announcementEmbedDescriptionInput = document.getElementById('announcementEmbedDescription');
            announcementEmbedColorInput = document.getElementById('announcementEmbedColor');
            announcementEmbedFooterInput = document.getElementById('announcementEmbedFooter');
            announcementEmbedThumbnailInput = document.getElementById('announcementEmbedThumbnail');

            // Embed preview elements
            verificationEmbedPreview = document.getElementById('verification-embed-preview');
            previewVerificationEmbedTitle = document.getElementById('preview-verification-embed-title');
            previewVerificationEmbedDescription = document.getElementById('preview-verification-embed-description');
            previewVerificationEmbedFooter = document.getElementById('preview-verification-embed-footer');
            previewVerificationEmbedThumbnail = document.getElementById('preview-verification-embed-thumbnail');
            announcementEmbedPreview = document.getElementById('announcement-embed-preview');
            previewAnnouncementEmbedTitle = document.getElementById('preview-announcement-embed-title');
            previewAnnouncementEmbedDescription = document.getElementById('preview-announcement-embed-description');
            previewAnnouncementEmbedFooter = document.getElementById('preview-announcement-embed-footer');
            previewAnnouncementEmbedThumbnail = document.getElementById('preview-announcement-embed-thumbnail');

            // Buttons
            saveGeneralSettingsBtn = document.getElementById('saveGeneralSettings');
            saveWelcomeSettingsBtn = document.getElementById('saveWelcomeSettings');
            saveLoggingSettingsBtn = document.getElementById('saveLoggingSettings');
            saveTicketSettingsBtn = document.getElementById('saveTicketSettings');
            saveVerificationSettingsBtn = document.getElementById('saveVerificationSettings');
            addCustomCommandBtn = document.getElementById('addCustomCommand');
            addReactionRoleBtn = document.getElementById('addReactionRole');
            addLevelRewardBtn = document.getElementById('addLevelReward');
            saveMusicSettingsBtn = document.getElementById('saveMusicSettings');
            saveIntegrationsSettingsBtn = document.getElementById('saveIntegrationsSettings');
            saveLevelingSettingsBtn = document.getElementById('saveLevelingSettings');
            saveAdvancedSettingsBtn = document.getElementById('saveAdvancedSettings');
            sendAnnouncementBtn = document.getElementById('sendAnnouncementBtn');
            refreshAuditLogBtn = document.getElementById('refreshAuditLog');

            // Status messages
            generalStatusMsg = document.getElementById('generalStatus');
            welcomeStatusMsg = document.getElementById('welcomeStatus');
            loggingStatusMsg = document.getElementById('loggingStatus');
            ticketStatusMsg = document.getElementById('ticketStatus');
            verificationStatusMsg = document.getElementById('verificationStatus');
            customCommandStatusMsg = document.getElementById('customCommandStatus');
            reactionRoleStatusMsg = document.getElementById('reactionRoleStatus');
            levelingStatusMsg = document.getElementById('levelingStatus');
            musicStatusMsg = document.getElementById('musicStatus');
            integrationsStatusMsg = document.getElementById('integrationsStatus');
            advancedStatusMsg = document.getElementById('advancedStatus');
            announcementStatusMsg = document.getElementById('announcementStatus');
            auditLogStatusMsg = document.getElementById('auditLogStatus');

            // Analytics elements
            totalMembersSpan = document.getElementById('totalMembers');
            messages24hSpan = document.getElementById('messages24h');
            newMembers7dSpan = document.getElementById('newMembers7d');
            memberGrowthChartCanvas = document.getElementById('memberGrowthChart');
            messageActivityChartCanvas = document.getElementById('messageActivityChart');

            // Audit Log elements
            auditLogSearchInput = document.getElementById('auditLogSearch');
            auditLogFilterTypeSelect = document.getElementById('auditLogFilterType');
            auditLogListDiv = document.getElementById('auditLogList');

            // Modal elements
            customModalOverlay = document.getElementById('customModalOverlay');
            modalTitle = document.getElementById('modalTitle');
            modalMessage = document.getElementById('modalMessage');
            modalCancelBtn = document.getElementById('modalCancelBtn');
            modalConfirmBtn = document.getElementById('modalConfirmBtn');

            // Set current year in footer
            document.getElementById('current-year').textContent = new Date().getFullYear();

            // --- Authentication and Data Fetching ---
            // The `initialAuthToken` is provided by the Canvas environment for authentication.
            // This part is crucial for identifying the user.
            // Note: Firebase authentication is used here as provided by the Canvas environment
            // to get the current user ID. This ID is then used for backend API calls.
            if (typeof auth !== 'undefined' && typeof onAuthStateChanged !== 'undefined') {
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        console.log("Authenticated user ID:", currentUserId);
                        await fetchUserData(); // Fetch user data from backend
                        await fetchBotGuilds(); // Fetch bot guilds from backend
                    } else {
                        // If no user is authenticated, try to sign in anonymously
                        // or with the custom token if provided.
                        try {
                            // __initial_auth_token is provided by the Canvas environment
                            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                await signInWithCustomToken(auth, __initial_auth_token);
                                console.log("Signed in with custom token.");
                            } else {
                                await signInAnonymously(auth);
                                console.log("Signed in anonymously.");
                            }
                        } catch (error) {
                            console.error("Firebase authentication error:", error);
                            showMessage('Authentication failed. Please try logging in again.', 'error');
                            usernameSpan.textContent = 'Guest';
                            guildListElement.innerHTML = '<li class="text-red-400 p-3">Authentication failed.</li>';
                        }
                    }
                });
            } else {
                console.error("Firebase Auth not loaded. Cannot authenticate user.");
                usernameSpan.textContent = 'Error: Auth Not Loaded';
                guildListElement.innerHTML = '<li class="text-red-400 p-3">Authentication system not available.</li>';
            }


            // --- Event Listeners ---
            // Navigation clicks
            navGeneral.addEventListener('click', (e) => { e.preventDefault(); showSection('general-settings'); });
            navWelcome.addEventListener('click', (e) => { e.preventDefault(); showSection('welcome-settings'); });
            navLogging.addEventListener('click', (e) => { e.preventDefault(); showSection('logging-settings'); });
            navTicket.addEventListener('click', (e) => { e.preventDefault(); showSection('ticket-settings'); });
            navVerification.addEventListener('click', (e) => { e.preventDefault(); showSection('verification-settings'); });
            navCustomCommands.addEventListener('click', (e) => { e.preventDefault(); showSection('custom-commands-settings'); });
            navReactionRoles.addEventListener('click', (e) => { e.preventDefault(); showSection('reaction-roles-settings'); });
            navLeveling.addEventListener('click', (e) => { e.preventDefault(); showSection('leveling-settings'); });
            navMusic.addEventListener('click', (e) => { e.preventDefault(); showSection('music-settings'); });
            navIntegrations.addEventListener('click', (e) => { e.preventDefault(); showSection('integrations-settings'); });
            navAnalytics.addEventListener('click', (e) => { e.preventDefault(); showSection('analytics-settings'); });
            navAuditLog.addEventListener('click', (e) => { e.preventDefault(); showSection('audit-log-settings'); });
            navAdvanced.addEventListener('click', (e) => { e.preventDefault(); showSection('advanced-settings'); });
            navAnnouncement.addEventListener('click', (e) => { e.preventDefault(); showSection('announcement-settings'); });

            // Save buttons
            saveGeneralSettingsBtn.addEventListener('click', () => saveSettings('general'));
            saveWelcomeSettingsBtn.addEventListener('click', () => saveSettings('welcome'));
            saveLoggingSettingsBtn.addEventListener('click', () => saveSettings('logging'));
            saveTicketSettingsBtn.addEventListener('click', () => saveSettings('ticket'));
            saveVerificationSettingsBtn.addEventListener('click', () => saveSettings('verification'));
            saveAdvancedSettingsBtn.addEventListener('click', () => saveSettings('advanced'));
            saveMusicSettingsBtn.addEventListener('click', () => saveSettings('music'));
            saveIntegrationsSettingsBtn.addEventListener('click', () => saveSettings('integrations'));
            saveLevelingSettingsBtn.addEventListener('click', () => saveSettings('leveling'));

            // Specific action buttons
            addCustomCommandBtn.addEventListener('click', addCustomCommand);
            addReactionRoleBtn.addEventListener('click', addReactionRole);
            addLevelRewardBtn.addEventListener('click', addLevelReward);
            sendAnnouncementBtn.addEventListener('click', sendAnnouncement);
            refreshAuditLogBtn.addEventListener('click', () => loadAuditLog(selectedGuildId));

            // Embed preview updates
            verificationEmbedTitleInput.addEventListener('input', updateVerificationEmbedPreview);
            verificationEmbedDescriptionInput.addEventListener('input', updateVerificationEmbedPreview);
            verificationEmbedColorInput.addEventListener('input', updateVerificationEmbedPreview);
            verificationEmbedFooterInput.addEventListener('input', updateVerificationEmbedPreview);
            verificationEmbedThumbnailInput.addEventListener('input', updateVerificationEmbedPreview);

            announcementEmbedTitleInput.addEventListener('input', updateAnnouncementEmbedPreview);
            announcementEmbedDescriptionInput.addEventListener('input', updateAnnouncementEmbedPreview);
            announcementEmbedColorInput.addEventListener('input', updateAnnouncementEmbedPreview);
            announcementEmbedFooterInput.addEventListener('input', updateAnnouncementEmbedPreview);
            announcementEmbedThumbnailInput.addEventListener('input', updateAnnouncementEmbedPreview);

            // Custom command type change listener
            newCommandTypeInput.addEventListener('change', () => {
                if (newCommandTypeInput.value === 'embed') {
                    newCommandEmbedFieldsDiv.classList.remove('hidden');
                } else {
                    newCommandEmbedFieldsDiv.classList.add('hidden');
                }
            });

            // Audit log search/filter
            auditLogSearchInput.addEventListener('input', () => filterAuditLog());
            auditLogFilterTypeSelect.addEventListener('change', () => filterAuditLog());
        });

        /**
         * Displays a temporary, non-blocking message notification.
         * @param {string} message - The message to display.
         * @param {'success'|'error'} type - The type of message (determines color).
         */
        function showMessage(message, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            messageDiv.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg text-white z-50 transition-all transform ease-out duration-300 ${type === 'success' ? 'bg-green-600' : 'bg-red-600'} translate-x-full opacity-0`;
            document.body.appendChild(messageDiv);

            // Animate in
            setTimeout(() => {
                messageDiv.classList.remove('translate-x-full', 'opacity-0');
                messageDiv.classList.add('translate-x-0', 'opacity-100');
            }, 10); // Small delay to ensure transition applies

            // Animate out and remove
            setTimeout(() => {
                messageDiv.classList.remove('translate-x-0', 'opacity-100');
                messageDiv.classList.add('translate-x-full', 'opacity-0');
                messageDiv.addEventListener('transitionend', () => messageDiv.remove());
            }, 3000);
        }

        /**
         * Shows a custom modal dialog for confirmations or alerts.
         * @param {string} title - The title of the modal.
         * @param {string} message - The message content of the modal.
         * @param {boolean} isConfirm - If true, shows a "Cancel" button.
         * @returns {Promise<boolean>} Resolves true if confirmed, false if cancelled.
         */
        function showCustomModal(title, message, isConfirm = false) {
            return new Promise(resolve => {
                modalTitle.textContent = title;
                modalMessage.textContent = message;

                if (isConfirm) {
                    modalCancelBtn.classList.remove('hidden');
                } else {
                    modalCancelBtn.classList.add('hidden');
                }

                // Clear previous listeners
                const cloneConfirm = modalConfirmBtn.cloneNode(true);
                modalConfirmBtn.parentNode.replaceChild(cloneConfirm, modalConfirmBtn);
                modalConfirmBtn = cloneConfirm;

                const cloneCancel = modalCancelBtn.cloneNode(true);
                modalCancelBtn.parentNode.replaceChild(cloneCancel, modalCancelBtn);
                modalCancelBtn = cloneCancel;

                // Add new listeners
                modalConfirmBtn.addEventListener('click', () => {
                    customModalOverlay.classList.remove('show');
                    resolve(true);
                });
                modalCancelBtn.addEventListener('click', () => {
                    customModalOverlay.classList.remove('show');
                    resolve(false);
                });

                customModalOverlay.classList.add('show');
            });
        }

        /**
         * Fetches user data from the backend (PostgreSQL).
         * Assumes an endpoint like `/api/user` that returns the logged-in user's details.
         */
        async function fetchUserData() {
            usernameSpan.textContent = 'Loading...';
            try {
                const response = await fetch(`${BASE_URL}/user`); // Your server.js already has this endpoint
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const userData = await response.json();
                if (userData && userData.username) {
                    usernameSpan.textContent = userData.username; // Assuming 'username' field from Discord profile
                } else {
                    usernameSpan.textContent = 'User Not Found';
                    showMessage('User data not found on backend.', 'error');
                }
            } catch (error) {
                console.error('Error fetching user data from backend:', error);
                usernameSpan.textContent = 'Error Loading User';
                showMessage('Failed to load user data. Please check backend connection.', 'error');
            }
        }

        /**
         * Fetches guilds where the bot is present from the backend (PostgreSQL).
         * Assumes an endpoint like `/api/bot-guilds` that returns a list of guilds.
         */
        async function fetchBotGuilds() {
            guildListElement.innerHTML = '<li class="text-gray-400 p-3">Loading servers...</li>';
            try {
                const response = await fetch(`${BASE_URL}/bot-guilds`); // Your server.js already has this endpoint
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                if (data && Array.isArray(data)) { // Discord API returns an array directly
                    botGuilds = data; // Update global botGuilds
                    renderGuildList(); // Re-render the list with fetched data
                } else {
                    guildListElement.innerHTML = '<li class="text-gray-400 p-3">No bot servers found.</li>';
                    guildsHeader.classList.add('hidden');
                    showMessage('No bot server data available from backend.', 'error');
                }
            } catch (error) {
                console.error('Error fetching bot guilds from backend:', error);
                guildListElement.innerHTML = '<li class="text-red-400 p-3">Could not load bot servers. Check backend.</li>';
                guildsHeader.classList.add('hidden');
                showMessage('Failed to load bot server list. Check backend connection.', 'error');
            }
        }

        /**
         * Renders the list of guilds in the sidebar where the bot is present.
         * Now uses the `botGuilds` fetched from the backend.
         */
        function renderGuildList() {
            guildListElement.innerHTML = ''; // Clear existing list

            if (botGuilds.length === 0) {
                guildsHeader.classList.add('hidden');
                guildListElement.innerHTML = '<li class="text-gray-400 p-3">ZeroPoint Bot is not in any servers.</li>';
                return;
            }

            guildsHeader.classList.remove('hidden');

            botGuilds.forEach(guild => {
                const listItem = document.createElement('li');
                listItem.className = 'guild-card flex items-center p-3 rounded-md bg-[#282828] hover:bg-[#3A3A3A] transition-colors duration-200';
                listItem.dataset.guildId = guild.id;
                // Use guild.icon if available from your backend, otherwise use first letter
                const guildIconHtml = guild.icon
                    ? `<img src="https://cdn.discordapp.com/icons/${guild.id}/${guild.icon}.png?size=32" alt="${guild.name} icon" class="w-8 h-8 rounded-full mr-3">`
                    : `<div class="w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white text-sm font-bold mr-3">${guild.name.charAt(0)}</div>`;

                listItem.innerHTML = `
                    ${guildIconHtml}
                    <span class="text-white font-medium">${guild.name}</span>
                `;
                listItem.addEventListener('click', () => selectGuild(guild.id, guild.name));
                guildListElement.appendChild(listItem);
            });
        }

        /**
         * Handles the selection of a guild from the sidebar.
         * Loads settings for the selected guild and updates the UI.
         * @param {string} guildId - The ID of the selected guild.
         * @param {string} guildName - The name of the selected guild.
         */
        async function selectGuild(guildId, guildName) {
            // Deselect previous guild visually
            if (selectedGuildId) {
                const prevSelected = document.querySelector(`.guild-card[data-guild-id="${selectedGuildId}"]`);
                if (prevSelected) {
                    prevSelected.classList.remove('selected');
                }
            }

            // Set new selected guild
            selectedGuildId = guildId;
            selectedGuildName = guildName; // Update global variable
            selectedGuildNameSpanElement.textContent = guildName;

            // Update UI visibility
            noGuildSelectedDiv.classList.add('hidden');
            settingsContentDiv.classList.remove('hidden');

            // Visually select the new guild
            const currentSelected = document.querySelector(`.guild-card[data-guild-id="${selectedGuildId}"]`);
            if (currentSelected) {
                currentSelected.classList.add('selected');
            }

            // Reset all status messages
            document.querySelectorAll('.status-message').forEach(msg => {
                msg.textContent = '';
                msg.classList.remove('show', 'status-success', 'status-error');
            });

            // Load settings for the newly selected guild
            await loadSettings(guildId);

            // Automatically show the general settings section after selecting a guild
            showSection('general-settings');
        }

        /**
         * Loads settings for a given guild from the backend.
         * @param {string} guildId - The ID of the guild to load settings for.
         */
        async function loadSettings(guildId) {
            console.log(`Loading settings for guild: ${guildId}`);
            // Show loading indicators for all sections here if desired

            try {
                // This is the primary API call to your backend to fetch all settings for the guild.
                // You NEED to implement this endpoint in your server.js to query your PostgreSQL DB.
                const response = await fetch(`${BASE_URL}/api/guild-settings/${guildId}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch settings: ${response.statusText}`);
                }
                const settings = await response.json();
                console.log(`Fetched settings for guild ${guildId}:`, settings);

                // Default settings if a specific setting is not found in the fetched data
                const defaultSettings = {
                    general: { botPrefix: '!', defaultRole: '' },
                    welcome: { welcomeChannel: '', farewellChannel: '', welcomeMessage: `Welcome {user} to ${selectedGuildName}! Enjoy your stay.`, farewellMessage: `{user} has left the server.`, sendWelcomeDM: false },
                    logging: { logChannel: '', logMessages: true, logChannels: true, logMembers: true },
                    ticket: { ticketCategory: '', ticketRole: '', ticketMessage: 'Hello {user}! How can we help you today?' },
                    verification: {
                        channelId: '', unverifiedRoleId: '', verifiedRoleId: '',
                        messageContent: 'Welcome {user}! To gain access to the server, please click the "Verify" button below.',
                        embed: {
                            title: '‚úÖ Server Verification',
                            description: 'Please click the button below to verify your account and gain full access to the server. This helps us keep our community safe!',
                            color: '#2cb4e9', footer: { text: 'ZeroPoint | Verification' }, thumbnail: { url: 'https://melonvisuals.me/test/zeropoint.png' }
                        }
                    },
                    customCommands: [],
                    reactionRoles: [],
                    leveling: { xpPerMessage: 15, xpCooldown: 60, levelUpMessage: 'Congratulations {user}, you reached level {level}!', levelUpChannel: '', rewards: [] },
                    music: { musicChannel: '', djRoleId: '', allowAnyoneQueue: true },
                    integrations: { webhookUrl: '', webhookChannelId: '' },
                    advanced: { commandCooldown: 3, enableAI: false, adminRoleId: '' },
                    analytics: {
                        totalMembers: 0, messages24h: 0, newMembers7d: 0,
                        memberGrowthData: [], messageActivityData: [], labels: []
                    },
                    auditLog: []
                };

                // Merge fetched settings with defaults to ensure all fields exist
                const mergedSettings = { ...defaultSettings, ...settings };
                for (const key in defaultSettings) {
                    if (typeof defaultSettings[key] === 'object' && defaultSettings[key] !== null && !Array.isArray(defaultSettings[key])) {
                        mergedSettings[key] = { ...defaultSettings[key], ...settings[key] };
                    }
                }

                // Populate input fields with fetched (or default) data
                botPrefixInput.value = mergedSettings.general.botPrefix;
                defaultRoleInput.value = mergedSettings.general.defaultRole;

                welcomeChannelInput.value = mergedSettings.welcome.welcomeChannel;
                welcomeMessageInput.value = mergedSettings.welcome.welcomeMessage;
                welcomeDMCheckbox.checked = mergedSettings.welcome.sendWelcomeDM;
                farewellChannelInput.value = mergedSettings.welcome.farewellChannel;
                farewellMessageInput.value = mergedSettings.welcome.farewellMessage;

                logChannelInput.value = mergedSettings.logging.logChannel;
                logMessagesCheckbox.checked = mergedSettings.logging.logMessages;
                logChannelsCheckbox.checked = mergedSettings.logging.logChannels;
                logMembersCheckbox.checked = mergedSettings.logging.logMembers;

                ticketCategoryInput.value = mergedSettings.ticket.ticketCategory;
                ticketRoleInput.value = mergedSettings.ticket.ticketRole;
                ticketMessageInput.value = mergedSettings.ticket.ticketMessage;

                verificationChannelIdInput.value = mergedSettings.verification.channelId;
                unverifiedRoleIdInput.value = mergedSettings.verification.unverifiedRoleId;
                verifiedRoleIdInput.value = mergedSettings.verification.verifiedRoleId;
                verificationMessageContentInput.value = mergedSettings.verification.messageContent;
                verificationEmbedTitleInput.value = mergedSettings.verification.embed.title;
                verificationEmbedDescriptionInput.value = mergedSettings.verification.embed.description;
                verificationEmbedColorInput.value = mergedSettings.verification.embed.color;
                verificationEmbedFooterInput.value = mergedSettings.verification.embed.footer.text;
                verificationEmbedThumbnailInput.value = mergedSettings.verification.embed.thumbnail.url;
                updateVerificationEmbedPreview();

                // Custom Commands
                renderCustomCommands(mergedSettings.customCommands);

                // Reaction Roles
                renderReactionRoles(mergedSettings.reactionRoles);

                // Leveling
                xpPerMessageInput.value = mergedSettings.leveling.xpPerMessage;
                xpCooldownInput.value = mergedSettings.leveling.xpCooldown;
                levelUpMessageInput.value = mergedSettings.leveling.levelUpMessage;
                levelUpChannelInput.value = mergedSettings.leveling.levelUpChannel;
                renderLevelRewards(mergedSettings.leveling.rewards);

                // Music
                musicChannelInput.value = mergedSettings.music.musicChannel;
                djRoleIdInput.value = mergedSettings.music.djRoleId;
                allowAnyoneQueueCheckbox.checked = mergedSettings.music.allowAnyoneQueue;

                // Integrations
                webhookUrlInput.value = mergedSettings.integrations.webhookUrl;
                webhookChannelIdInput.value = mergedSettings.integrations.webhookChannelId;

                commandCooldownInput.value = mergedSettings.advanced.commandCooldown;
                enableAICheckbox.checked = mergedSettings.advanced.enableAI;
                adminRoleIdInput.value = mergedSettings.advanced.adminRoleId;

                // Clear Announcement Builder fields on guild change (always fresh)
                announcementChannelIdInput.value = '';
                announcementEmbedTitleInput.value = '';
                announcementEmbedDescriptionInput.value = '';
                announcementEmbedColorInput.value = '#5F9EA0'; // Default color
                announcementEmbedFooterInput.value = '';
                announcementEmbedThumbnailInput.value = '';
                updateAnnouncementEmbedPreview();

                // Load Analytics Data
                totalMembersSpan.textContent = mergedSettings.analytics.totalMembers.toLocaleString();
                messages24hSpan.textContent = mergedSettings.analytics.messages24h.toLocaleString();
                newMembers7dSpan.textContent = mergedSettings.analytics.newMembers7d.toLocaleString();
                renderMemberGrowthChart(mergedSettings.analytics.labels, mergedSettings.analytics.memberGrowthData);
                renderMessageActivityChart(mergedSettings.analytics.labels, mergedSettings.analytics.messageActivityData);

                // Load Audit Log
                currentAuditLogs = mergedSettings.auditLog; // Store the full log data
                filterAuditLog(); // Apply initial filter/search
            } catch (error) {
                console.error('Error loading settings for guild:', error);
                showMessage(`Failed to load settings for ${selectedGuildName}. Please check backend connection.`, 'error');
                // Optionally clear fields or show a "failed to load" state
                // For now, fields will retain their default empty/initial values if fetch fails.
            }
        }

        /**
         * Saves settings for the currently selected guild to the backend.
         * @param {string} settingType - The category of settings being saved (e.g., 'general', 'welcome').
         */
        async function saveSettings(settingType) {
            if (!selectedGuildId) {
                await showCustomModal('Error', 'Please select a server first!', false);
                return;
            }

            let dataToSave = {};
            let statusMessageElement;
            let saveButtonElement;
            let endpoint = `${BASE_URL}/api/guild-settings/${selectedGuildId}/${settingType}`; // Generic endpoint for categories

            // Populate dataToSave based on settingType
            switch (settingType) {
                case 'general':
                    dataToSave = {
                        botPrefix: botPrefixInput.value,
                        defaultRole: defaultRoleInput.value
                    };
                    statusMessageElement = generalStatusMsg;
                    saveButtonElement = saveGeneralSettingsBtn;
                    break;
                case 'welcome':
                    dataToSave = {
                        welcomeChannel: welcomeChannelInput.value,
                        welcomeMessage: welcomeMessageInput.value,
                        sendWelcomeDM: welcomeDMCheckbox.checked,
                        farewellChannel: farewellChannelInput.value,
                        farewellMessage: farewellMessageInput.value
                    };
                    statusMessageElement = welcomeStatusMsg;
                    saveButtonElement = saveWelcomeSettingsBtn;
                    break;
                case 'logging':
                    dataToSave = {
                        logChannel: logChannelInput.value,
                        logMessages: logMessagesCheckbox.checked,
                        logChannels: logChannelsCheckbox.checked,
                        logMembers: logMembersCheckbox.checked
                    };
                    statusMessageElement = loggingStatusMsg;
                    saveButtonElement = saveLoggingSettingsBtn;
                    break;
                case 'ticket':
                    dataToSave = {
                        ticketCategory: ticketCategoryInput.value,
                        ticketRole: ticketRoleInput.value,
                        ticketMessage: ticketMessageInput.value
                    };
                    statusMessageElement = ticketStatusMsg;
                    saveButtonElement = saveTicketSettingsBtn;
                    break;
                case 'verification':
                    dataToSave = {
                        channelId: verificationChannelIdInput.value,
                        unverifiedRoleId: unverifiedRoleIdInput.value,
                        verifiedRoleId: verifiedRoleIdInput.value,
                        messageContent: verificationMessageContentInput.value,
                        embed: {
                            title: verificationEmbedTitleInput.value,
                            description: verificationEmbedDescriptionInput.value,
                            color: verificationEmbedColorInput.value,
                            footer: { text: verificationEmbedFooterInput.value },
                            thumbnail: { url: verificationEmbedThumbnailInput.value }
                        }
                    };
                    statusMessageElement = verificationStatusMsg;
                    saveButtonElement = saveVerificationSettingsBtn;
                    break;
                case 'leveling':
                    dataToSave = {
                        xpPerMessage: parseInt(xpPerMessageInput.value, 10),
                        xpCooldown: parseInt(xpCooldownInput.value, 10),
                        levelUpMessage: levelUpMessageInput.value,
                        levelUpChannel: levelUpChannelInput.value,
                        // Rewards are managed separately by addLevelReward/deleteLevelReward
                    };
                    statusMessageElement = levelingStatusMsg;
                    saveButtonElement = saveLevelingSettingsBtn;
                    break;
                case 'music':
                    dataToSave = {
                        musicChannel: musicChannelInput.value,
                        djRoleId: djRoleIdInput.value,
                        allowAnyoneQueue: allowAnyoneQueueCheckbox.checked
                    };
                    statusMessageElement = musicStatusMsg;
                    saveButtonElement = saveMusicSettingsBtn;
                    break;
                case 'integrations':
                    dataToSave = {
                        webhookUrl: webhookUrlInput.value,
                        webhookChannelId: webhookChannelIdInput.value
                    };
                    statusMessageElement = integrationsStatusMsg;
                    saveButtonElement = saveIntegrationsSettingsBtn;
                    break;
                case 'advanced':
                    dataToSave = {
                        commandCooldown: parseInt(commandCooldownInput.value, 10),
                        enableAI: enableAICheckbox.checked,
                        adminRoleId: adminRoleIdInput.value
                    };
                    statusMessageElement = advancedStatusMsg;
                    saveButtonElement = saveAdvancedSettingsBtn;
                    break;
                default:
                    console.error('Unknown setting type:', settingType);
                    return;
            }

            // Disable button and show saving status
            saveButtonElement.disabled = true;
            statusMessageElement.textContent = 'Saving...';
            statusMessageElement.classList.remove('status-success', 'status-error');
            statusMessageElement.classList.add('show');

            try {
                // This is the API call to your backend to save settings.
                // You NEED to implement this endpoint in your server.js to update your PostgreSQL DB.
                const response = await fetch(endpoint, {
                    method: 'POST', // or PUT, depending on your backend's design
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dataToSave)
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                // const result = await response.json(); // If your backend returns a confirmation

                statusMessageElement.textContent = 'Settings saved successfully!';
                statusMessageElement.classList.add('status-success');
                console.log(`Saved ${settingType} settings for guild ${selectedGuildId}:`, dataToSave);
            } catch (error) {
                console.error('Error saving settings:', error);
                statusMessageElement.textContent = `Error: ${error.message}`;
                statusMessageElement.classList.add('status-error');
            } finally {
                saveButtonElement.disabled = false;
                setTimeout(() => {
                    statusMessageElement.classList.remove('show');
                }, 3000);
            }
        }

        /**
         * Adds a new custom command to the backend.
         */
        async function addCustomCommand() {
            if (!selectedGuildId) {
                await showCustomModal('Error', 'Please select a server first!', false);
                return;
            }

            const commandName = newCommandNameInput.value.trim().toLowerCase();
            const commandResponse = newCommandResponseInput.value.trim();
            const commandType = newCommandTypeInput.value;

            if (!commandName || !commandResponse) {
                customCommandStatusMsg.textContent = 'Command name and response cannot be empty.';
                customCommandStatusMsg.classList.add('show', 'status-error');
                setTimeout(() => customCommandStatusMsg.classList.remove('show'), 3000);
                return;
            }

            let commandData = { name: commandName, response: commandResponse, type: commandType };

            if (commandType === 'embed') {
                commandData.embed = {
                    title: newCommandEmbedTitleInput.value.trim(),
                    description: newCommandEmbedDescriptionInput.value.trim(),
                    color: newCommandEmbedColorInput.value.trim()
                };
                if (!commandData.embed.title && !commandData.embed.description) {
                    customCommandStatusMsg.textContent = 'Embed commands require at least a title or description.';
                    customCommandStatusMsg.classList.add('show', 'status-error');
                    setTimeout(() => customCommandStatusMsg.classList.remove('show'), 3000);
                    return;
                }
            }

            customCommandStatusMsg.textContent = 'Adding command...';
            customCommandStatusMsg.classList.remove('status-success', 'status-error');
            customCommandStatusMsg.classList.add('show');

            try {
                // This is the API call to your backend to add a custom command.
                // You NEED to implement this endpoint in your server.js to update your PostgreSQL DB.
                const response = await fetch(`${BASE_URL}/api/guild-settings/${selectedGuildId}/custom-commands`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(commandData)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                }

                customCommandStatusMsg.textContent = `Command '${commandName}' added successfully!`;
                customCommandStatusMsg.classList.add('status-success');

                // Reload all settings to get the updated list including the new command
                await loadSettings(selectedGuildId);

                // Clear form fields
                newCommandNameInput.value = '';
                newCommandResponseInput.value = '';
                newCommandTypeInput.value = 'text';
                newCommandEmbedFieldsDiv.classList.add('hidden');
                newCommandEmbedTitleInput.value = '';
                newCommandEmbedDescriptionInput.value = '';
                newCommandEmbedColorInput.value = '';

            } catch (error) {
                console.error('Error adding custom command:', error);
                customCommandStatusMsg.textContent = `Error: ${error.message}`;
                customCommandStatusMsg.classList.add('status-error');
            } finally {
                setTimeout(() => customCommandStatusMsg.classList.remove('show'), 3000);
            }
        }

        /**
         * Renders the list of custom commands.
         * @param {Array<Object>} commands - Array of custom command objects.
         */
        function renderCustomCommands(commands) {
            const customCommandsList = document.getElementById('customCommandsList');
            customCommandsList.innerHTML = ''; // Clear existing list

            if (commands.length === 0) {
                customCommandsList.innerHTML = '<li class="text-gray-400">No custom commands added yet.</li>';
                return;
            }

            commands.forEach((cmd, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'flex items-center justify-between p-3 rounded-md bg-gray-800 border border-gray-700';
                listItem.innerHTML = `
                    <div class="flex-1">
                        <span class="font-semibold text-white">!${cmd.name}</span>
                        <p class="text-gray-400 text-sm truncate">${cmd.type === 'text' ? cmd.response : `[Embed] ${cmd.embed.title || cmd.embed.description}`}</p>
                    </div>
                    <button class="text-red-400 hover:text-red-600 ml-4 delete-command-btn" data-index="${index}"><i class="fas fa-trash-alt"></i></button>
                `;
                customCommandsList.appendChild(listItem);
            });

            // Add event listeners for delete buttons
            customCommandsList.querySelectorAll('.delete-command-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index, 10);
                    deleteCustomCommand(index);
                });
            });
        }

        /**
         * Deletes a custom command from the backend.
         * @param {number} index - The index of the command to delete.
         */
        async function deleteCustomCommand(index) {
            const confirmed = await showCustomModal('Confirm Deletion', 'Are you sure you want to delete this custom command?', true);
            if (!confirmed) {
                return;
            }

            customCommandStatusMsg.textContent = 'Deleting command...';
            customCommandStatusMsg.classList.remove('status-success', 'status-error');
            customCommandStatusMsg.classList.add('show');

            try {
                // This is the API call to your backend to delete a custom command.
                // You NEED to implement this endpoint in your server.js to update your PostgreSQL DB.
                const response = await fetch(`${BASE_URL}/api/guild-settings/${selectedGuildId}/custom-commands/${index}`, {
                    method: 'DELETE'
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                }

                customCommandStatusMsg.textContent = 'Command deleted successfully!';
                customCommandStatusMsg.classList.add('status-success');

                // Reload all settings to get the updated list
                await loadSettings(selectedGuildId);

            } catch (error) {
                console.error('Error deleting custom command:', error);
                customCommandStatusMsg.textContent = `Error: ${error.message}`;
                customCommandStatusMsg.classList.add('status-error');
            } finally {
                setTimeout(() => customCommandStatusMsg.classList.remove('show'), 3000);
            }
        }

        /**
         * Adds a new reaction role to the backend.
         */
        async function addReactionRole() {
            if (!selectedGuildId) {
                await showCustomModal('Error', 'Please select a server first!', false);
                return;
            }

            const channelId = reactionRoleChannelIdInput.value.trim();
            const messageContent = reactionRoleMessageContentInput.value.trim();
            const emoji = reactionRoleEmojiInput.value.trim();
            const roleId = reactionRoleRoleIdInput.value.trim();

            if (!channelId || !messageContent || !emoji || !roleId) {
                reactionRoleStatusMsg.textContent = 'All fields are required for a reaction role.';
                reactionRoleStatusMsg.classList.add('show', 'status-error');
                setTimeout(() => reactionRoleStatusMsg.classList.remove('show'), 3000);
                return;
            }

            const newReactionRole = { channelId, messageContent, emoji, roleId };

            reactionRoleStatusMsg.textContent = 'Adding reaction role...';
            reactionRoleStatusMsg.classList.remove('status-success', 'status-error');
            reactionRoleStatusMsg.classList.add('show');

            try {
                // This is the API call to your backend to add a reaction role.
                // You NEED to implement this endpoint in your server.js to update your PostgreSQL DB.
                const response = await fetch(`${BASE_URL}/api/guild-settings/${selectedGuildId}/reaction-roles`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newReactionRole)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                }

                reactionRoleStatusMsg.textContent = 'Reaction role added successfully!';
                reactionRoleStatusMsg.classList.add('status-success');

                // Reload all settings to get the updated list
                await loadSettings(selectedGuildId);

                // Clear form fields
                reactionRoleChannelIdInput.value = '';
                reactionRoleMessageContentInput.value = '';
                reactionRoleEmojiInput.value = '';
                reactionRoleRoleIdInput.value = '';

            } catch (error) {
                console.error('Error adding reaction role:', error);
                reactionRoleStatusMsg.textContent = `Error: ${error.message}`;
                reactionRoleStatusMsg.classList.add('status-error');
            } finally {
                setTimeout(() => reactionRoleStatusMsg.classList.remove('show'), 3000);
            }
        }

        /**
         * Renders the list of reaction roles.
         * @param {Array<Object>} reactionRoles - Array of reaction role objects.
         */
        function renderReactionRoles(reactionRoles) {
            const reactionRolesList = document.getElementById('reactionRolesList');
            reactionRolesList.innerHTML = '';

            if (reactionRoles.length === 0) {
                reactionRolesList.innerHTML = '<li class="text-gray-400">No reaction roles configured yet.</li>';
                return;
            }

            reactionRoles.forEach((rr, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'flex items-center justify-between p-3 rounded-md bg-gray-800 border border-gray-700';
                listItem.innerHTML = `
                    <div class="flex-1">
                        <span class="font-semibold text-white">Channel: ${rr.channelId}</span>
                        <p class="text-gray-400 text-sm truncate">Emoji: ${rr.emoji} -> Role: ${rr.roleId}</p>
                        <p class="text-gray-500 text-xs truncate">${rr.messageContent}</p>
                    </div>
                    <button class="text-red-400 hover:text-red-600 ml-4 delete-reaction-role-btn" data-index="${index}"><i class="fas fa-trash-alt"></i></button>
                `;
                reactionRolesList.appendChild(listItem);
            });

            reactionRolesList.querySelectorAll('.delete-reaction-role-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index, 10);
                    deleteReactionRole(index);
                });
            });
        }

        /**
         * Deletes a reaction role from the backend.
         * @param {number} index - The index of the reaction role to delete.
         */
        async function deleteReactionRole(index) {
            const confirmed = await showCustomModal('Confirm Deletion', 'Are you sure you want to delete this reaction role?', true);
            if (!confirmed) {
                return;
            }

            reactionRoleStatusMsg.textContent = 'Deleting reaction role...';
            reactionRoleStatusMsg.classList.remove('status-success', 'status-error');
            reactionRoleStatusMsg.classList.add('show');

            try {
                // This is the API call to your backend to delete a reaction role.
                // You NEED to implement this endpoint in your server.js to update your PostgreSQL DB.
                const response = await fetch(`${BASE_URL}/api/guild-settings/${selectedGuildId}/reaction-roles/${index}`, {
                    method: 'DELETE'
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                }

                reactionRoleStatusMsg.textContent = 'Reaction role deleted successfully!';
                reactionRoleStatusMsg.classList.add('status-success');

                // Reload all settings to get the updated list
                await loadSettings(selectedGuildId);

            } catch (error) {
                console.error('Error deleting reaction role:', error);
                reactionRoleStatusMsg.textContent = `Error: ${error.message}`;
                reactionRoleStatusMsg.classList.add('status-error');
            } finally {
                setTimeout(() => reactionRoleStatusMsg.classList.remove('show'), 3000);
            }
        }

        /**
         * Adds a new level reward to the backend.
         */
        async function addLevelReward() {
            if (!selectedGuildId) {
                await showCustomModal('Error', 'Please select a server first!', false);
                return;
            }

            const level = parseInt(rewardLevelInput.value, 10);
            const roleId = rewardRoleIdInput.value.trim();

            if (isNaN(level) || level <= 0 || !roleId) {
                levelingStatusMsg.textContent = 'Please provide a valid level and role ID.';
                levelingStatusMsg.classList.add('show', 'status-error');
                setTimeout(() => levelingStatusMsg.classList.remove('show'), 3000);
                return;
            }

            const newReward = { level, roleId };

            levelingStatusMsg.textContent = 'Adding level reward...';
            levelingStatusMsg.classList.remove('status-success', 'status-error');
            levelingStatusMsg.classList.add('show');

            try {
                // This is the API call to your backend to add a level reward.
                // You NEED to implement this endpoint in your server.js to update your PostgreSQL DB.
                const response = await fetch(`${BASE_URL}/api/guild-settings/${selectedGuildId}/leveling-rewards`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newReward)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                }

                levelingStatusMsg.textContent = `Level reward for level ${level} added successfully!`;
                levelingStatusMsg.classList.add('status-success');

                // Reload all settings to get the updated list
                await loadSettings(selectedGuildId);

                // Clear form fields
                rewardLevelInput.value = '';
                rewardRoleIdInput.value = '';

            } catch (error) {
                console.error('Error adding level reward:', error);
                levelingStatusMsg.textContent = `Error: ${error.message}`;
                levelingStatusMsg.classList.add('status-error');
            } finally {
                setTimeout(() => levelingStatusMsg.classList.remove('show'), 3000);
            }
        }

        /**
         * Renders the list of level rewards.
         * @param {Array<Object>} rewards - Array of level reward objects.
         */
        function renderLevelRewards(rewards) {
            const levelRewardsList = document.getElementById('levelRewardsList');
            levelRewardsList.innerHTML = '';

            if (rewards.length === 0) {
                levelRewardsList.innerHTML = '<li class="text-gray-400">No level rewards configured yet.</li>';
                return;
            }

            rewards.forEach((reward, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'flex items-center justify-between p-3 rounded-md bg-gray-800 border border-gray-700';
                listItem.innerHTML = `
                    <div class="flex-1">
                        <span class="font-semibold text-white">Level ${reward.level}:</span>
                        <p class="text-gray-400 text-sm">Role ID: ${reward.roleId}</p>
                    </div>
                    <button class="text-red-400 hover:text-red-600 ml-4 delete-level-reward-btn" data-index="${index}"><i class="fas fa-trash-alt"></i></button>
                `;
                levelRewardsList.appendChild(listItem);
            });

            levelRewardsList.querySelectorAll('.delete-level-reward-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index, 10);
                    deleteLevelReward(index);
                });
            });
        }

        /**
         * Deletes a level reward from the backend.
         * @param {number} index - The index of the reward to delete.
         */
        async function deleteLevelReward(index) {
            const confirmed = await showCustomModal('Confirm Deletion', 'Are you sure you want to delete this level reward?', true);
            if (!confirmed) {
                return;
            }

            levelingStatusMsg.textContent = 'Deleting level reward...';
            levelingStatusMsg.classList.remove('status-success', 'status-error');
            levelingStatusMsg.classList.add('show');

            try {
                // This is the API call to your backend to delete a level reward.
                // You NEED to implement this endpoint in your server.js to update your PostgreSQL DB.
                const response = await fetch(`${BASE_URL}/api/guild-settings/${selectedGuildId}/leveling-rewards/${index}`, {
                    method: 'DELETE'
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                }

                levelingStatusMsg.textContent = 'Level reward deleted successfully!';
                levelingStatusMsg.classList.add('status-success');

                // Reload all settings to get the updated list
                await loadSettings(selectedGuildId);

            } catch (error) {
                console.error('Error deleting level reward:', error);
                levelingStatusMsg.textContent = `Error: ${error.message}`;
                levelingStatusMsg.classList.add('status-error');
            } finally {
                setTimeout(() => levelingStatusMsg.classList.remove('show'), 3000);
            }
        }


        /**
         * Sends an announcement message via the backend.
         */
        async function sendAnnouncement() {
            if (!selectedGuildId) {
                await showCustomModal('Error', 'Please select a server first!', false);
                return;
            }

            const channelId = announcementChannelIdInput.value.trim();
            const embedTitle = announcementEmbedTitleInput.value.trim();
            const embedDescription = announcementEmbedDescriptionInput.value.trim();
            const embedColor = announcementEmbedColorInput.value.trim();
            const embedFooterText = announcementEmbedFooterInput.value.trim();
            const embedThumbnailUrl = announcementEmbedThumbnailInput.value.trim();

            if (!channelId || (!embedTitle && !embedDescription)) {
                announcementStatusMsg.textContent = 'Please provide a Channel ID and at least an Embed Title or Description.';
                announcementStatusMsg.classList.add('show', 'status-error');
                setTimeout(() => announcementStatusMsg.classList.remove('show'), 3000);
                return;
            }

            // Convert hex color to decimal for Discord embed (if applicable in a real bot)
            const colorDecimal = embedColor ? parseInt(embedColor.replace('#', ''), 16) : null;

            const embedData = {
                title: embedTitle,
                description: embedDescription,
                color: colorDecimal,
                timestamp: new Date().toISOString(), // Current time
                footer: {
                    text: embedFooterText || 'ZeroPoint Bot Announcement'
                }
            };

            if (embedThumbnailUrl) {
                embedData.thumbnail = { url: embedThumbnailUrl };
            }

            // Disable button and show sending status
            sendAnnouncementBtn.disabled = true;
            announcementStatusMsg.textContent = 'Sending announcement...';
            announcementStatusMsg.classList.remove('status-success', 'status-error');
            announcementStatusMsg.classList.add('show');

            try {
                // This is the API call to your backend to send an announcement.
                // Your server.js already has this endpoint.
                const response = await fetch(`${BASE_URL}/api/send-announcement/${selectedGuildId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ channelId, embedData })
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `Failed to send announcement: ${response.statusText}`);
                }

                announcementStatusMsg.textContent = 'Announcement sent successfully!';
                announcementStatusMsg.classList.add('status-success');
                console.log(`Announcement sent to channel ${channelId} in guild ${selectedGuildId}.`);

                // Clear fields after successful send
                announcementChannelIdInput.value = '';
                announcementEmbedTitleInput.value = '';
                announcementEmbedDescriptionInput.value = '';
                announcementEmbedColorInput.value = '#5F9EA0';
                announcementEmbedFooterInput.value = '';
                announcementEmbedThumbnailInput.value = '';
                updateAnnouncementEmbedPreview();

            } catch (error) {
                console.error('Error sending announcement:', error);
                announcementStatusMsg.textContent = `Error: ${error.message}`;
                announcementStatusMsg.classList.add('status-error');
            } finally {
                sendAnnouncementBtn.disabled = false;
                setTimeout(() => {
                    announcementStatusMsg.classList.remove('show');
                }, 3000);
            }
        }

        /**
         * Updates the preview of the verification embed based on input fields.
         */
        function updateVerificationEmbedPreview() {
            previewVerificationEmbedTitle.textContent = verificationEmbedTitleInput.value || 'Verification Embed Title';
            previewVerificationEmbedDescription.textContent = verificationEmbedDescriptionInput.value || 'Click the button to gain full access.';
            previewVerificationEmbedFooter.textContent = verificationEmbedFooterInput.value || 'ZeroPoint | Verification';

            let color = verificationEmbedColorInput.value;
            if (color && color.startsWith('#') && color.length === 7) {
                verificationEmbedPreview.style.setProperty('--embed-color', color);
            } else {
                verificationEmbedPreview.style.setProperty('--embed-color', '#4299e1'); // Default blue
            }

            const thumbnailUrl = verificationEmbedThumbnailInput.value;
            if (thumbnailUrl) {
                previewVerificationEmbedThumbnail.src = thumbnailUrl;
                previewVerificationEmbedThumbnail.classList.remove('hidden');
            } else {
                previewVerificationEmbedThumbnail.src = '';
                previewVerificationEmbedThumbnail.classList.add('hidden');
            }
        }

        /**
         * Updates the preview of the announcement embed based on input fields.
         */
        function updateAnnouncementEmbedPreview() {
            previewAnnouncementEmbedTitle.textContent = announcementEmbedTitleInput.value || 'Important Update!';
            previewAnnouncementEmbedDescription.textContent = announcementEmbedDescriptionInput.value || 'Details about the announcement...';
            previewAnnouncementEmbedFooter.textContent = announcementEmbedFooterInput.value || 'ZeroPoint Bot Announcement';

            let color = announcementEmbedColorInput.value;
            if (color && color.startsWith('#') && color.length === 7) {
                announcementEmbedPreview.style.setProperty('--embed-color', color);
            } else {
                announcementEmbedPreview.style.setProperty('--embed-color', '#5F9EA0'); // Default color for announcement
            }

            const thumbnailUrl = announcementEmbedThumbnailInput.value;
            if (thumbnailUrl) {
                previewAnnouncementEmbedThumbnail.src = thumbnailUrl;
                previewAnnouncementEmbedThumbnail.classList.remove('hidden');
            } else {
                previewAnnouncementEmbedThumbnail.src = '';
                previewAnnouncementEmbedThumbnail.classList.add('hidden');
            }
        }

        /**
         * Shows a specific settings section and updates navigation active state.
         * @param {string} sectionId - The ID of the section to show (e.g., 'general-settings').
         */
        function showSection(sectionId) {
            // Hide all settings sections
            document.querySelectorAll('.settings-section').forEach(section => {
                section.classList.add('hidden');
            });

            // Show the requested section
            document.getElementById(sectionId).classList.remove('hidden');

            // Deactivate all sidebar navigation items
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });

            // Activate the corresponding sidebar navigation item
            const navItemId = `nav-${sectionId.replace('-settings', '')}`;
            const navItem = document.getElementById(navItemId);
            if (navItem) {
                navItem.classList.add('active');
            }

            // Special handling for analytics charts (re-render when visible)
            if (sectionId === 'analytics-settings' && selectedGuildId) {
                // When analytics section is shown, fetch fresh data and render charts
                fetchAnalyticsData(selectedGuildId);
            }
        }

        /**
         * Fetches analytics data for a given guild from the backend.
         * @param {string} guildId - The ID of the guild.
         */
        async function fetchAnalyticsData(guildId) {
            totalMembersSpan.textContent = '--';
            messages24hSpan.textContent = '--';
            newMembers7dSpan.textContent = '--';
            if (memberGrowthChartInstance) memberGrowthChartInstance.destroy();
            if (messageActivityChartInstance) messageActivityChartInstance.destroy();

            try {
                // This is the API call to your backend to fetch analytics data.
                // You NEED to implement this endpoint in your server.js to query your PostgreSQL DB.
                const response = await fetch(`${BASE_URL}/api/analytics/${guildId}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch analytics data: ${response.statusText}`);
                }
                const analyticsData = await response.json();
                console.log(`Fetched analytics for guild ${guildId}:`, analyticsData);

                totalMembersSpan.textContent = (analyticsData.totalMembers || 0).toLocaleString();
                messages24hSpan.textContent = (analyticsData.messages24h || 0).toLocaleString();
                newMembers7dSpan.textContent = (analyticsData.newMembers7d || 0).toLocaleString();

                renderMemberGrowthChart(analyticsData.labels || [], analyticsData.memberGrowthData || []);
                renderMessageActivityChart(analyticsData.labels || [], analyticsData.messageActivityData || []);

            } catch (error) {
                console.error('Error fetching analytics data:', error);
                showMessage('Failed to load server analytics. Please check backend connection.', 'error');
                totalMembersSpan.textContent = 'Error';
                messages24hSpan.textContent = 'Error';
                newMembers7dSpan.textContent = 'Error';
            }
        }


        /**
         * Renders the Member Growth Chart using Chart.js.
         * @param {Array<string>} labels - Labels for the X-axis (e.g., dates).
         * @param {Array<number>} data - Data points for the chart.
         */
        function renderMemberGrowthChart(labels, data) {
            if (memberGrowthChartInstance) {
                memberGrowthChartInstance.destroy(); // Destroy existing chart if it exists
            }
            const ctx = memberGrowthChartCanvas.getContext('2d');
            memberGrowthChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'New Members',
                        data: data,
                        borderColor: '#5F9EA0', // Cadet Blue
                        backgroundColor: 'rgba(95, 158, 160, 0.2)',
                        fill: true,
                        tension: 0.3, // Smooth curves
                        pointBackgroundColor: '#5F9EA0',
                        pointBorderColor: '#FFF',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#EAEAEA' // Light text for legend
                            }
                        },
                        title: {
                            display: false,
                            text: 'Member Growth Over Time',
                            color: '#EAEAEA'
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(85, 85, 85, 0.3)' // Lighter grid lines
                            },
                            ticks: {
                                color: '#B0B0B0' // Light gray ticks
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(85, 85, 85, 0.3)'
                            },
                            ticks: {
                                color: '#B0B0B0'
                            }
                        }
                    }
                }
            });
        }

        /**
         * Renders the Message Activity Chart using Chart.js.
         * @param {Array<string>} labels - Labels for the X-axis (e.g., dates).
         * @param {Array<number>} data - Data points for the chart.
         */
        function renderMessageActivityChart(labels, data) {
            if (messageActivityChartInstance) {
                messageActivityChartInstance.destroy(); // Destroy existing chart if it exists
            }
            const ctx = messageActivityChartCanvas.getContext('2d');
            messageActivityChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Messages Sent',
                        data: data,
                        backgroundColor: '#4682B4', // Steel Blue
                        borderColor: '#4682B4',
                        borderWidth: 1,
                        borderRadius: 5 // Rounded bars
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#EAEAEA'
                            }
                        },
                        title: {
                            display: false,
                            text: 'Message Activity (Last 7 Days)',
                            color: '#EAEAEA'
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(85, 85, 85, 0.3)'
                            },
                            ticks: {
                                color: '#B0B0B0'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(85, 85, 85, 0.3)'
                            },
                            ticks: {
                                color: '#B0B0B0'
                            }
                        }
                    }
                }
            });
        }

        let currentAuditLogs = []; // Stores the full list of logs for the current guild

        /**
         * Loads and renders audit log entries for the selected guild from the backend.
         * Applies search and filter criteria.
         * @param {string} guildId - The ID of the guild.
         */
        async function loadAuditLog(guildId) {
            if (!guildId) {
                auditLogListDiv.innerHTML = '<p class="text-gray-400 text-center py-4">Please select a server to view audit logs.</p>';
                return;
            }

            auditLogListDiv.innerHTML = '<p class="text-gray-400 text-center py-4">Loading audit log entries...</p>';
            auditLogStatusMsg.textContent = '';
            auditLogStatusMsg.classList.remove('show', 'status-success', 'status-error');

            try {
                // This is the API call to your backend to fetch audit log data.
                // You NEED to implement this endpoint in your server.js to query your PostgreSQL DB.
                const response = await fetch(`${BASE_URL}/api/audit-log/${guildId}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch audit log: ${response.statusText}`);
                }
                const allLogs = await response.json();
                console.log(`Fetched ${allLogs.length} audit log entries for guild ${guildId}.`);

                currentAuditLogs = allLogs; // Store the full list of logs
                filterAuditLog(); // Apply initial filter/search
            } catch (error) {
                console.error('Error fetching audit log data:', error);
                auditLogListDiv.innerHTML = '<p class="text-red-400 text-center py-4">Failed to load audit log entries. Check backend connection.</p>';
                auditLogStatusMsg.textContent = `Error: ${error.message}`;
                auditLogStatusMsg.classList.add('show', 'status-error');
                currentAuditLogs = []; // Clear logs on error
            }
        }

        /**
         * Filters and renders the audit log entries based on search query and type filter.
         */
        function filterAuditLog() {
            const searchQuery = auditLogSearchInput.value.toLowerCase();
            const filterType = auditLogFilterTypeSelect.value;

            let filteredLogs = currentAuditLogs.filter(log => {
                const matchesSearch = (log.user && log.user.toLowerCase().includes(searchQuery)) ||
                                      (log.description && log.description.toLowerCase().includes(searchQuery)) ||
                                      (log.type && log.type.toLowerCase().includes(searchQuery));
                const matchesType = filterType === '' || (log.type && log.type === filterType);
                return matchesSearch && matchesType;
            });

            renderAuditLogEntries(filteredLogs);
        }

        /**
         * Renders the given audit log entries into the UI.
         * @param {Array<Object>} logs - Array of audit log entries to render.
         */
        function renderAuditLogEntries(logs) {
            auditLogListDiv.innerHTML = ''; // Clear existing list

            if (logs.length === 0) {
                auditLogListDiv.innerHTML = '<p class="text-gray-400 text-center py-4">No audit log entries found matching your criteria.</p>';
                return;
            }

            logs.forEach(log => {
                const logItem = document.createElement('div');
                logItem.className = 'p-3 rounded-md bg-gray-800 border border-gray-700 flex flex-col sm:flex-row justify-between items-start sm:items-center';
                logItem.innerHTML = `
                    <div class="flex-1 mb-2 sm:mb-0">
                        <p class="font-semibold text-white">${log.user || 'Unknown User'} <span class="text-gray-500 text-sm ml-2">(${log.type ? log.type.replace('_', ' ') : 'Unknown Action'})</span></p>
                        <p class="text-gray-300 text-sm">${log.description || 'No description provided.'}</p>
                    </div>
                    <span class="text-gray-500 text-xs sm:text-sm flex-shrink-0">${log.timestamp ? new Date(log.timestamp).toLocaleString() : 'N/A'}</span>
                `;
                auditLogListDiv.appendChild(logItem);
            });
        }
    </script>
</body>
</html>
